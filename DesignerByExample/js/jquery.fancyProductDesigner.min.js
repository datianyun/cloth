 /*
 * Fancy Product Designer v1.1
 *
 * Copyright 2011, Rafael Dery
 *
 */

(function(h) {
    var g = function(g, I) {
        var m = h.extend({}, h.fn.fancyProductDesigner.defaults, I), p = this, w, D, T, B, e, c, b, j, a, d, U, J, q, E, P, da, y, fa, M = 0, C = -1, G = null, n = 0, s = null, H = 0, R = !1, S = !1, Z = !1, Q = !1, V = "Helvetica";
        w = h(g).addClass("fpd-container fpd-clearfix");
        E = w.children(".fpd-product").remove();
        P = w.children(".fpd-design, .fpd-motive").children("img, span");
        J = document.createElement("canvas");
        if (!Boolean(J.getContext && J.getContext("2d")))
            return w.append('<div class="fpd-browser-alert"><p>' + m.canvasAlert + "</p></div>").children("div").append('<span><a href="http://www.mozilla.org/firefox/new/" title="Download Firefox" class="firefox"></a><a href="http://www.google.com/Chrome" title="Download Chrome" class="chrome"></a><a href="http://www.opera.com/download/" title="Download Opera" class="opera"></a></span>'), w.trigger("canvasFail"), !1;
        1 < E.size() && (D = w.append('<div class="fpd-product-selection"><a href="#" class="fpd-scroll-up ui-state-default"><span class="ui-icon ui-icon-carat-1-n"></span></a><div><ul></ul></div><a href="#" class="fpd-scroll-down ui-state-default"><span class="ui-icon ui-icon-carat-1-s"></span></a></div>').children(".fpd-product-selection").find("ul"));
        T = w.append('<div class="fpd-product-container"><div><div class="fpd-toolbar"></div><div class="fpd-elements"></div><div class="fpd-saved-products"><ul></ul></div></div><section class="fpd-clearfix"></section></div>').children(".fpd-product-container").children("div");
        0 < P.size() && (c = w.append('<div class="fpd-design-selection"><a href="#" class="fpd-scroll-up ui-state-default"><span class="ui-icon ui-icon-carat-1-n"></span></a><div><ul class="fpd-clearfix  Swirl"></ul></div><a href="#" class="fpd-scroll-down ui-state-default"><span class="ui-icon ui-icon-carat-1-s"></span></a></div><div class="fpd-design-selection "><a href="#" class="fpd-scroll-up ui-state-default"><span class="ui-icon ui-icon-carat-1-n"></span></a><div><ul class="fpd-clearfix Dress" ></ul></div><a href="#" class="fpd-scroll-down ui-state-default"><span class="ui-icon ui-icon-carat-1-s"></span></a></div><div class="fpd-design-selection "><a href="#" class="fpd-scroll-up ui-state-default"><span class="ui-icon ui-icon-carat-1-n"></span></a><div><ul class="fpd-clearfix Waist"></ul></div><a href="#" class="fpd-scroll-down ui-state-default"><span class="ui-icon ui-icon-carat-1-s"></span></a></div>').children(".fpd-design-selection").find("ul"), P.parent().remove());
        b = T.children(".fpd-toolbar").append('<div class="fpd-color-picker fpd-clearfix"><input type="text" value="" disabled="disabled" /></div><select class="fpd-fonts-dropdown"></select><input type="text" value="" class="fpd-text-input" /><div class="fpd-z-switcher ui-state-default" title="' + m.labels.zPositionSwitcher + '"><span class="ui-icon ui-icon-carat-2-n-s"></span></div><div class="fpd-reset ui-state-default" title="' + m.labels.resetButton + '"><span class="ui-icon ui-icon-refresh"></span></div><div class="fpd-deselect ui-state-default" title="' + m.labels.deselectButton + '"><span class="ui-icon ui-icon-closethick"></span></div>');
        J = T.parent().children("section");
        e = T.children(".fpd-saved-products");
        j = b.children(".fpd-color-picker");
        d = b.children(".fpd-z-switcher");
        U = b.children(".fpd-text-input");
        B = T.children(".fpd-elements");
        this.getProduct = function(b) {
            onlyEditableElemets = "undefined" !== typeof b ? b : !1;
            if (Q)
                return alert(m.outOfContainmentAlert), !1;
            f();
            if (0 < T.children(".fpd-views").length) {
                for (var a = [], l = T.children(".fpd-views").children("li"), r = 0; r < l.length; ++r) {
                    var F = l[r], ha = {title: h(F).children("img").attr("title"),elements: []};
                    if (void 0 == h(F).data("elements"))
                        h(y.get(r)).children("img, span").each(function(l, r) {
                            var a = h(r), F = h.extend({}, m.elementParameters, a.data("parameters"));
                            if (b) {
                                if (0 < F.colors.length || F.removable || F.draggable || F.resizable || F.rotatable) {
                                    var f = {};
                                    f.title = a.attr("title");
                                    f.source = a.attr("src");
                                    f.parameters = F;
                                    ha.elements[ha.elements.length] = f
                                }
                            } else
                                f = {}, f.title = a.attr("title"), f.source = a.attr("src"), f.parameters = F, ha.elements[ha.elements.length] = f
                        });
                    else if (b) {
                        var d = [];
                        h(h(F).data("elements")).each(function(l, r) {
                            var a = r.parameters;
                            (0 < a.colors.length || a.removable || a.draggable || a.resizable || a.rotatable) && d.push(r)
                        });
                        d.sort(function(l, r) {
                            return Number(l.parameters.z) - Number(r.parameters.z)
                        });
                        ha.elements = d
                    } else
                        ha.elements = h(F).data("elements"), ha.elements.sort(function(l, r) {
                            return Number(l.parameters.z) - Number(r.parameters.z)
                        });
                    a.push(ha)
                }
                return a
            }
            ha = {title: E[C].title,elements: []};
            B.children(b ? ".fpd-editable" : ".fpd-element").each(function(l, r) {
                var a = {}, b = h(r);
                a.title = b.attr("title");
                a.source = b.data("source");
                a.parameters = b.data("params");
                ha.elements[l] = a
            });
            ha.elements.sort(function(l, r) {
                return Number(l.parameters.z) - Number(r.parameters.z)
            });
            return ha
        };
        this.addElement = function(a, b, l, r,ct) {
            f();
            $();
            if ("object" != typeof r)
                return alert("The element " + l + " has not a valid JSON object as parameters!"), !1;
            r = h.extend({}, m.elementParameters, r);
            r.source = b;
            r.originX = r.x;
            r.originY = r.y;
            var F = B.append('<div class="fpd-element"></div>').children("div:last").css({left: r.x,top: r.y,"z-index": B.children("div").size() - 1}).attr("title", l).attr("category", ct).data("source", b).attr("id", B.children(".fpd-element").size() - 1);
            r.z = B.children(".fpd-element").size() - 1;
            ia(F, r.degree);
            if (r.colors && "string" == typeof r.colors) {
                var d = r.colors.replace(/\s+/g, "").split(",");
                r.colors = d;
                r.currentColor = d[0]
            }
            if ("image" == a) {
                var t = new Image;
                t.src = b;
                t.onload = function() {
                    var l = r.width ? r.width : t.width * r.scale, a = r.height ? r.height : t.height * r.scale;
                    if (0 < r.colors.length) {
                        var b = r.currentColor, f = document.createElement("canvas"), d = f.getContext("2d");
                        f.width = this.width;
                        f.height = this.height;
                        d.drawImage(this, 0, 0);
                        F.append(f);
                        W(d, b)
                    } else
                        F.append(t);
                    F.children("canvas, img").width(l).height(a).parent().css({width: l,height: a});
                    0 < r.colors.length || r.removable || r.draggable || r.resizable || r.rotatable ? v(F) : F.css("pointer-events", "none");
                    r.originWidth = l;
                    r.originHeight = a;
                    r.width = l;
                    r.height = a;
                    F.data("params", r);
                    w.trigger("elementAdded", [F])
                }
            } else
                "text" == a ? (r.text = r.text ? r.text : r.source, r.font = r.font ? r.font : V, r.textSize = r.textSize ? r.textSize : m.textSize * r.scale, a = h("<p>" + r.text + "</p>"), F.append(a).children("p:first").css({fontSize: r.textSize,fontFamily: r.font,paddingTop: 8,paddingRight: 5,paddingBottom: 8,paddingLeft: 5}), 0 < r.colors.length && a.css("color", r.currentColor), v(F), F.data("params", r), w.trigger("elementAdded", [F])) : alert("Sorry. This type of element is not allowed!");
            r.price && (H += r.price, w.trigger("priceChange", [r.price, H]));
            0 < y.size() && (fa.push({title: l,source: b,parameters: r}), h(T.children(".fpd-views").children("li").get(n)).data("elements", fa))
        };
        this.addDesign = function(a, b, l,ct) {
        	var target;
        	switch(ct){
        		case "Swirl":
        		      target=h(c[0]);
        		      break;
        		case "Dress":
        		      target=h(c[1]);
        		      break;
        		case "Waist":
        		      target=h(c[2]);
        		      break;
        		default:
        		      target=h(c[0]);
        		     
        	}
            target.prepend("<li></li>").children("li:first").append('<img src="' + a + '" title="' + b + '" category="' + ct + '"/>').click(function() {
                var l = h(this).children("img");
                var length = B.children(".fpd-editable").length;
                for(var i=0;i<length;i++){
                	if(l.attr("category")==h(B.children(".fpd-editable")[i]).attr("category")){
                		h(B.children(".fpd-editable")[i]).remove();
                		if(l.data("parameters").price){
                			H -= l.data("parameters").price, 
                			w.trigger("priceChange", [l.data("parameters").price, H]);
                		}

                		break ;
                	}
                }
                p.addElement("image", l.attr("src"), l.attr("title"), l.data("parameters"),l.attr("category"));
                return !1
            }).children("img").data("parameters", l)
        };
        this.getPrice = function() {
            return H
        };
        this.print = function() {
            f();
            var a = window.open("", "", "width=" + T.width() + ",height=" + T.height() + ",location=no,menubar=no,scrollbars=no,status=no,toolbar=no");
            B.html2canvas({onrendered: function(b) {
                    h(a.document.body).append('<img src="' + b.toDataURL("image/png") + '" />');
                    a.document.title = "Print Image";
                    setTimeout(function() {
                        a.print()
                    }, 1E3)
                }})
        };
        this.clear = function() {
            f();
            B.children(".fpd-element").remove()
        };
        this.createImage = function(a, b) {
            "undefined" === typeof a && (a = !0);
            "undefined" === typeof b && (b = !1);
            f();
            B.html2canvas({onrendered: function(l) {
                    var r = l.toDataURL("image/png");
                    if (a) {
                        var f = window.open("", "", "width=" + T.width() + ",height=" + T.height() + ",location=no,menubar=no,scrollbars=no,status=no,toolbar=no");
                        f.document.title = "Product Image";
                        h(f.document.body).append('<img src="' + r + '" />');
                        b && (window.location.href = f.document.getElementsByTagName("img")[0].src.replace("image/png", "image/octet-stream"))
                    }
                    w.trigger("imageCreate", [l, r])
                }});
            return !1
        };
        var x = function(a) {
            if (a == C)
                return !1;
            C = a;
            n = 0;
            T.children(".fpd-views").remove();
            y = h(E.get(a)).children(".fpd-product");
            if (0 < y.size()) {
                y.splice(0, 0, E.get(a));
                for (var b = T.append('<ul class="fpd-views fpd-clearfix"></ul>').children(".fpd-views"), l = 0; l < y.length; ++l) {
                    var r = h(y[l]);
                    b.append('<li><img src="' + r.data("thumbnail") + '" title="' + r.attr("title") + '" /></li>')
                }
                t(E.get(a).title, h(E.get(a)).children("img, span"));
                b.children("li").click(function() {
                    var l = h(this), a = b.children("li").index(l);
                    if (a != n) {
                        f();
                        n = a;
                        var r = h(b.children("li").get(a)).data("elements");
                        t(l.children("img").attr("title"), void 0 == r ? h(y.get(a)).children("img, span") : r.sort(function(l, a) {
                            return Number(l.parameters.z) - Number(a.parameters.z)
                        }))
                    }
                })
            } else
                t(E.get(a).title, h(E.get(a)).children("img, span"))
        }, t = function(a, b) {
            f();
            $();
            fa = [];
            M = H = 0;
            G = a;
            B.children(".fpd-element").remove();
            for (var l = 0; l < b.length; ++l) {
                var r = h(b[l]);
                if (r.is("img,span")) {
                    var F = void 0 == r.data("parameters") ? {} : r.data("parameters");
                    p.addElement(r.is("img") ? "image" : "text", r.is("img") ? r.attr("src") : r.text(), r.attr("title"), F)
                } else
                    p.addElement(void 0 == b[l].parameters.text ? "image" : "text", b[l].parameters.source, b[l].title, b[l].parameters)
            }
            m.allowProductSaving && (l = ba(), l = h.map(l, function(l, a) {
                return a
            }).length, 0 < l ? q.show().children(".fpd-product-counter").text(l) : q.hide())
        }, v = function(t) {
            t.addClass("fpd-editable").children("img, canvas, p").css("cursor", "pointer").click(function() {
                f();
                $();
                var c = t.data("params");
                b.show();
                0 < t.children("p").size() && (a.show(), a.children('option[value="' + c.font + '"]').prop("selected", "selected"), U.show().val(t.children("p").text()));
                s = t.addClass("selected");
                c.removable && s.append('<button title="' + m.labels.removeElementButton + '" class="fpd-remove ui-state-default ui-corner-all"><span class="ui-icon ui-icon-trash"></span></button>').children(".fpd-remove ").hammer().bind("tap", function() {
                    0 != s.data("params").price && (H -= s.data("params").price, w.trigger("priceChange", [s.data("params").price, H]));
                    fa.splice(s.attr("id"), 1);
                    h(this).parent().remove();
                    f();
                    return !1
                });
                c.draggable && (tempy = null, s.append('<button title="' + m.labels.dragElementButton + '" class="fpd-drag ui-state-default ui-corner-all"><span class="ui-icon ui-icon-arrow-4"></span></button>').children(".fpd-drag").hammer({drag_min_distance: 1}).bind("dragstart", function() {
                    R = !0
                }));
                c.resizable && s.append('<button title="' + m.labels.resizeElementButton + '" class="fpd-resize ui-state-default ui-corner-all"><span class="ui-icon ui-icon-arrowthick-2-se-nw"></span></button>').children(".fpd-resize").hammer({drag_min_distance: 1}).bind("dragstart", function() {
                    S = !0
                });
                c.rotatable && s.append('<button title="' + m.labels.rotateElementButton + '" class="fpd-rotate ui-state-default ui-corner-all"><span class="ui-icon ui-icon-arrowrefresh-1-e"></span></button>').children(".fpd-rotate").hammer({drag_min_distance: 1}).bind("dragstart", function() {
                    Z = !0
                });
                c.colors ? (j.children("input").val(c.currentColor), 1 < c.colors.length ? j.children("input").spectrum("destroy").spectrum({preferredFormat: "hex",showPaletteOnly: !0,palette: c.colors,change: function(l) {
                        ka(s, l.toHexString())
                    }}) : j.children("input").spectrum("destroy").spectrum({preferredFormat: "hex",showInput: !0,chooseText: "Change Color",change: function(l) {
                        ka(s, l.toHexString())
                    }}), j.show()) : j.hide();
                c.zChangeable && d.show();
                if ("string" == typeof c.boundingBox) {
                    var l = B.children('div[title="' + c.boundingBox + '"]');
                    0 < l.size() && (c.boundingBox = {x: l.position().left,y: l.position().top,width: l.width(),height: l.height()})
                }
                "object" == typeof c.boundingBox && (c = c.boundingBox, B.append('<div class="containment"></div>').children(".containment").css({left: c.x,top: c.y,width: c.width,height: c.height,"z-index": B.children("div").size() - 1}));
                s.children("button").disableSelection();
                m.editorMode && ca()
            })
        }, ka = function(a, b) {
            4 == b.length && (b += b.substr(1, b.length));
            if (0 < a.children("p").size())
                a.children("p").css("color", b);
            else {
                var l = a.children("canvas").get(0);
                W(l.getContext("2d"), b)
            }
            a.data("params").currentColor = b;
            j.children("input").spectrum("set", b)
        }, W = function(a, b) {
            for (var l = a.getImageData(0, 0, a.canvas.width, a.canvas.height), r = l.data, f = 0; f < r.length; f += 4)
                r[f] = parseInt(N(b).substring(0, 2), 16), r[f + 1] = parseInt(N(b).substring(2, 4), 16), r[f + 2] = parseInt(N(b).substring(4, 6), 16);
            a.putImageData(l, 0, 0)
        }, f = function() {
            B.children("div").removeClass("selected").children("button").remove();
            B.children("div.containment").remove();
            j.hide();
            d.hide();
            b.hide();
            a.hide();
            U.val("").hide();
            s = null;
            m.editorMode && da.find("p > span:nth-child(2n)").text("")
        }, u = function(a, b, l, r) {
            var f = s.data("params").boundingBox, c = !1;
            a < f.x && (c = !0);
            b < f.y && (c = !0);
            a + l > f.x + f.width && (c = !0);
            b + r > f.y + f.height && (c = !0);
            return c
        }, ca = function() {
            if (s) {
                var a = s.data("params");
                da.children(".fpd-current-element").children("span:last").text(s.attr("title"));
                da.children(".fpd-position").children("span:last").text("x: " + a.x + ", y: " + a.y);
                da.children(".fpd-dimensions").children("span:last").text(a.width ? "Width: " + a.width + "px, Height: " + a.height + "px" : "Textsize: " + a.textSize + "px")
            }
        }, ia = function(a, b) {
            a.css("-moz-transform", "rotate(" + b + "deg)");
            a.css("-webkit-transform", "rotate(" + b + "deg)");
            a.css("-o-transform", "rotate(" + b + "deg)");
            a.css("-ms-transform", "rotate(" + b + "deg)")
        }, ba = function() {
            for (var a = 0, b = 0, l = {}, r = Object.keys(localStorage), f; f = r[a]; ) {
                var c = f.substr(0, f.indexOf("_"));
                G == c && (l[f] = JSON.parse(window.localStorage.getItem(f)), b++);
                a++
            }
            return l
        }, ja = function(a) {
            var b = Number(q.children("span").text());
            a = "+" == a ? b + 1 : b - 1;
            0 >= a ? (q.hide().children(".fpd-product-counter").text(""), $()) : q.show().children(".fpd-product-counter").text(String(a))
        }, $ = function() {
            e.hasClass("fpd-showing") && e.removeClass("fpd-showing").animate({left: -(e.outerWidth() + 10)}, 300)
        }, N = function(a) {
            return "#" == a.charAt(0) ? a.substring(1, 7) : a
        };
        w.children("div:last").css("marginRight", 0).trigger("ready");
        if (D) {
            for (var A = 0; A < E.length; ++A) {
                var X = h(E[A]);
                D.append('<li><img src="' + X.data("thumbnail") + '" title="' + X.attr("title") + '" /></li>')
            }
            D.children("li").click(function() {
                var a = D.find("li").index(h(this));
                s = null;
                x(a);
                return !1
            })
        }
        if (c)
            for (A = 0; A < P.length; ++A)
                p.addDesign(P[A].src, P[A].title, h(P[A]).data("parameters"),P[A].attributes.category.nodeValue);
         a = b.children(".fpd-fonts-dropdown").change(function() {
            s.data("params").font = this.value;
            s.children("p").css("font-family", this.value)
        });
        d.click(function() {
            var a = parseInt(s.css("z-index"));
            s.css("z-index", ++a);
            B.children("div").size() == a && s.css("z-index", -1);
            s.data("params").z = parseInt(s.css("z-index"))
        });
        m.customTexts && J.append('<button title="' + m.labels.customTextButton + '" class="fpd-add-custom-text ui-state-default ui-corner-all"><span class="ui-icon ui-icon-pencil"></span><span>' + m.customTexts + "</span></button>").children(".fpd-add-custom-text").click(function() {
            p.addElement("text", m.defaultCustomText, m.defaultCustomText, m.customTextParamters);
            return !1
        });
        m.allowProductSaving && (J.append('<button title="' + m.labels.saveProductButton + '" class="fpd-save-product fpd-clearfix ui-state-default ui-corner-all"><span class="ui-icon ui-icon-disk"></span><span>' + m.labels.saveProductButton + '</span></button><button title="' + m.labels.savedProductsButton + '" class="fpd-saved-products ui-state-default ui-corner-all" style="display: none;"><span class="ui-icon ui-icon-note"></span><span>' + m.labels.savedProductsButton + '</span><span class="fpd-product-counter"></span></button>').children(".fpd-save-product").click(function() {
            f();
            $();
            var a = prompt(m.labels.saveProductInput, ""), b;
            if (null == a)
                b = -1;
            else if ("" == a)
                b = 0;
            else {
                b = 1;
                var l = Object.keys(ba());
                for (k in l)
                    if (l[k] == G + "_" + a) {
                        b = 2;
                        break
                    }
            }
            if (-1 == b)
                return !1;
            if (0 == b)
                return alert(m.labels.keyNotValidAlert), !1;
            if (2 == b) {
                var r = confirm(m.labels.keyInUseAlert);
                if (!r)
                    return !1
            }
            b = p.getProduct(!1);
            if (b instanceof Array) {
                for (A in b)
                    if (b[A].title == G) {
                        view = b[A];
                        break
                    }
                b = JSON.stringify(view)
            } else
                b = JSON.stringify(b);
            localStorage.setItem(G + "_" + a, b);
            q.is(":hidden") ? q.show().children(".fpd-product-counter").text("1") : r || ja("+");
            return !1
        }), q = J.children(".fpd-saved-products").click(function() {
            f();
            if (e.is(":animated"))
                return !1;
            if (e.hasClass("fpd-showing"))
                $();
            else {
                e.children("ul").empty();
                var a = ba(), b = Object.keys(ba()).sort();
                for (A in b) {
                    var l = b[A], r = a[l];
                    e.children("ul").append('<li class="fpd-clearfix"><a href="#"><span class="ui-icon ui-icon-circle-close"></span></a><span title="' + r.title + '">' + l.substr(l.indexOf("_") + 1) + "</span></li>").children("li:last").children("span").click(function() {
                        t(this.title, h(this).data("elements"))
                    }).data("elements", r.elements).parent().children("a").click(function() {
                        if (!confirm(m.labels.confirmProductDelete))
                            return !1;
                        localStorage.removeItem(h(this).data("key"));
                        h(this).parent().remove();
                        ja("-");
                        return !1
                    }).data("key", l)
                }
                e.addClass("fpd-showing").animate({left: 0}, 300)
            }
            return !1
        }));
        J.append('<div class="fpd-element-switcher fpd-clearfix"><button title="' + m.labels.previousElementButton + '" class="ui-state-default"><span class="ui-icon ui-icon-arrowthick-1-w"></span></button><button title="' + m.labels.nextElementButton + '" class="ui-state-default"><span class="ui-icon ui-icon-arrowthick-1-e"></span></button></div>').find(".fpd-element-switcher > button:first").click(function() {
            s ? 0 == s.prevAll(".fpd-editable:first").size() ? B.children(".fpd-editable:last").children("img, canvas, p").click() : s.prevAll(".fpd-editable:first").children("img, canvas, p").click() : B.children(".fpd-editable:first").children("img, canvas, p").click();
            return !1
        }).parent().children("button:last").click(function() {
            s ? 0 == s.nextAll(".fpd-editable:first").size() ? B.children(".fpd-editable:first").children("img, canvas, p").click() : s.nextAll(".fpd-editable:first").children("img, canvas, p").click() : B.children(".fpd-editable:first").children("img, canvas, p").click();
            return !1
        });
        if (0 < m.fonts.length && m.fontDropdown) {
            V = m.fonts[0];
            m.fonts.sort();
            for (A = 0; A < m.fonts.length; ++A)
                a.append('<option value="' + m.fonts[A] + '" style="font-family: ' + m.fonts[A] + ';">' + m.fonts[A] + "</option>");
            a.children('option[value="' + V + '"]').prop("selected", "selected");
            a.show()
        }
        U.keyup(function() {
            s.children("p").text(this.value);
            s.data("params").text = this.value
        });
        w.find(".fpd-scroll-up").click(function() {
            var a = h(this).next("div").children("ul"), b = 0 < parseInt(a.css("top")) + m.scrollAmount ? Math.abs(parseInt(a.css("top"))) : m.scrollAmount;
            0 > parseInt(a.css("top")) && a.is(":not(:animated)") && a.animate({top: "+=" + b}, 200);
            return !1
        });
        w.find(".fpd-scroll-down").click(function() {
            var a = h(this).parent().children("div"), b = a.children("ul"), 
            l = Math.abs(parseInt(b.css("top"))) + a.height() + m.scrollAmount < b.height() ? -m.scrollAmount : Math.abs(parseInt(b.css("top"))) + a.height() - b.height();
            Math.abs(parseInt(b.css("top"))) + a.height() < b.height() && b.is(":not(:animated)") && b.animate({top: "+=" + l}, 200);
            return !1
        });
        b.children(".fpd-reset").click(function() {
            if (s) {
                var a = s.data("params");
                s.css({left: a.originX,top: a.originY,width: a.originWidth,height: a.originHeight});
                s.children("img, canvas").width(a.originWidth).height(a.originHeight);
                s.children("p").css({fontSize: m.textSize * a.scale,fontFamily: V}).text(a.source);
                ia(s, 0);
                a.colors && (ka(s, a.colors[0]), a.currentColor = a.colors[0]);
                a.x = a.originX;
                a.y = a.originY;
                a.width = a.originWidth;
                a.height = a.originHeight;
                a.degree = 0;
                s.data("params", a);
                a.boundingBox && (u(a.x, a.y, a.width, a.height) ? (w.trigger("elementOut"), Q = !0) : (w.trigger("elementIn"), Q = !1))
            }
        });
        b.children(".fpd-deselect").click(function() {
            f()
        });
        w.bind("elementAdded", function() {
            ++M == h(E.get(C)).children("img, span").size() && w.trigger("productCreate")
        });
        w.bind("elementOut", function() {
            s.append('<div class="fpd-warning"></div>').children("img, canvas, p").css("opacity", 0.5)
        });
        w.bind("elementIn", function() {
            s.children("img, canvas, p").css("opacity", 1);
            s.children(".fpd-warning").remove()
        });
        B.hammer({drag_min_distance: 1,hold_timeout: 100}).bind("drag", function(a) {
            if (null != s) {
                var b = s.offset();
                s.position();
                var l = b.left + s.width() / 2, r = b.top + s.height() / 2, f = a.touches[0].x, c = a.touches[0].y;
                a = s.data("params");
                Z ? (b = -1 * Math.atan2(f - l, c - r) * (180 / Math.PI) - 130, s.css("-moz-transform", "rotate(" + b + "deg)"), s.css("-webkit-transform", "rotate(" + b + "deg)"), s.css("-o-transform", "rotate(" + b + "deg)"), s.css("-ms-transform", "rotate(" + b + "deg)"), a.degree = b) : S ? 0 < s.children("img, canvas").size() ? (b = f - b.left < m.minImageWidth ? m.minImageWidth : f - b.left, b > m.maxImageWidth && (b = m.maxImageWidth), l = Math.round(a.originHeight * (b / a.originWidth)), s.children("img, canvas").css({width: b,height: l}).parent().width(b).height(l), a.width = b, a.height = l) : (b = c - b.top - 20 < m.minTextSize ? m.minTextSize : c - b.top - 20, b > m.maxTestSize && (b = m.maxTestSize), s.children("p").css({"font-size": b}).keyup(), s.data("params").textSize = b) : R && (s.css({left: "+=" + (f - s.children(".fpd-drag").offset().left - 4),top: "+=" + (c - s.children(".fpd-drag").offset().top - 4)}), s.data("params").x = parseFloat(s.css("left")), s.data("params").y = parseFloat(s.css("top")));
                if (a.boundingBox && (Z || R || S))
                    a = s.get(0).getBoundingClientRect().left - B.get(0).getBoundingClientRect().left - 1, r = s.get(0).getBoundingClientRect().top - B.get(0).getBoundingClientRect().top - 1, b = s.get(0).getBoundingClientRect().width - 3, l = s.get(0).getBoundingClientRect().height - 2, 0 < s.children("p").size() && (a += 5, r += 8, b -= 10, l -= 16), Q != u(a, r, b, l) && (u(a, r, b, l) ? (w.trigger("elementOut", [s]), Q = !0) : (w.trigger("elementIn", [s]), Q = !1));
                m.editorMode && (Z || R || S) && ca()
            }
        }).bind("release", function(a) {
            h(a.target).is("div") && (Z = S = R = !1)
        });
        m.editorMode && (da = w.append('<div class="fpd-editor-box"><h3>Editor Box</h3><p class="fpd-current-element"><span>Element: </span><span></span></p><p class="fpd-position"><span>Position: </span><span></span></p><p class="fpd-dimensions"><span>Dimensions: </span><span></span></p></div>').children(".fpd-editor-box"));
        x(0)
    };
    jQuery.fn.fancyProductDesigner = function(L) {
        return this.each(function() {
            var I = h(this);
            if (!I.data("fancy-product-designer")) {
                var m = new g(this, L);
                I.data("fancy-product-designer", m)
            }
        })
    };
    h.fn.fancyProductDesigner.defaults = {minImageWidth: 50,maxImageWidth: 300,minTextSize: 10,maxTestSize: 50,textSize: 18,scrollAmount: 100,fontDropdown: !0,fonts: ["Arial", "Helvetica", "Times New Roman", "Verdana", "Geneva"],customTexts: "Add text",defaultCustomText: "Enter your text here",customTextParamters: {},editorMode: !1,elementParameters: {x: 0,y: 0,z: 0,colors: !1,removable: !1,draggable: !1,rotatable: !1,resizable: !1,zChangeable: !1,scale: 1,degree: 0,price: 0,boundingBox: !1},labels: {canvasAlert: "Sorry! But your browser does not support HTML5 Canvas. Please update your browser!",outOfContainmentAlert: "An element is out of his containment. Please move it in his containment!",zPositionSwitcher: "Change Z-Position",resetButton: "Reset",deselectButton: "Deselect",removeElementButton: "Remove element",dragElementButton: "Drag element",resizeElementButton: "Resize Element",rotateElementButton: "Rotate Element",customTextButton: "Add custom text",previousElementButton: "Select previous editable element",nextElementButton: "Select next editable element",saveProductButton: "Save",savedProductsButton: "Saved products",saveProductInput: "Enter a key for your product:",keyNotValidAlert: "The key is not valid!",keyInUseAlert: "The key is already used. Would you like to use it anyway?",confirmProductDelete: "Delete saved product?"},allowProductSaving: !0}
})(jQuery);
(function(h, g, L) {
    function I(e) {
        p.logging && (h.console && h.console.log) && h.console.log(e)
    }
    function m(e, c, b, j, a, d) {
        c = p.Util.getCSS(c, e, a);
        var g;
        1 === c.length && (a = c[0], c = [], c[0] = a, c[1] = a);
        -1 !== c[0].toString().indexOf("%") ? (g = parseFloat(c[0]) / 100, a = b.width * g, "backgroundSize" !== e && (a -= (d || j).width * g)) : a = "backgroundSize" === e ? "auto" === c[0] ? j.width : c[0].match(/contain|cover/) ? p.Util.resizeBounds(j.width, j.height, b.width, b.height, c[0]).width : parseInt(c[0], 10) : parseInt(c[0], 10);
        "auto" === c[1] ? b = a / j.width * j.height : -1 !== c[1].toString().indexOf("%") ? (g = parseFloat(c[1]) / 100, b = b.height * g, "backgroundSize" !== e && (b -= (d || j).height * g)) : b = parseInt(c[1], 10);
        return [a, b]
    }
    var p = {}, w;
    p.Util = {};
    var D = String.prototype.trim;
    p.Util.trimText = function(e) {
        return D ? D.apply(e) : ((e || "") + "").replace(/^\s+|\s+$/g, "")
    };
    p.Util.parseBackgroundImage = function(e) {
        var c, b, j, a, d, g = [], J, q = 0, h = 0, p, m, y = function() {
            if (c) {
                '"' === b.substr(0, 1) && (b = b.substr(1, b.length - 2));
                b && m.push(b);
                if ("-" === c.substr(0, 1) && 0 < (a = c.indexOf("-", 1) + 1))
                    j = c.substr(0, a), c = c.substr(a);
                g.push({prefix: j,method: c.toLowerCase(),value: d,args: m})
            }
            m = [];
            c = j = b = d = ""
        };
        y();
        for (var I = 0, w = e.length; I < w; I++)
            if (J = e[I], !(0 === q && -1 < " \r\n\t".indexOf(J))) {
                switch (J) {
                    case '"':
                        p ? p === J && (p = null) : p = J;
                        break;
                    case "(":
                        if (p)
                            break;
                        else if (0 === q) {
                            q = 1;
                            d += J;
                            continue
                        } else
                            h++;
                        break;
                    case ")":
                        if (p)
                            break;
                        else if (1 === q)
                            if (0 === h) {
                                q = 0;
                                d += J;
                                y();
                                continue
                            } else
                                h--;
                        break;
                    case ",":
                        if (!p)
                            if (0 === q) {
                                y();
                                continue
                            } else if (1 === q && 0 === h && !c.match(/^url$/i)) {
                                m.push(b);
                                b = "";
                                d += J;
                                continue
                            }
                }
                d += J;
                0 === q ? c += J : b += J
            }
        y();
        return g
    };
    p.Util.Bounds = function(e) {
        var c = {};
        if (e.getBoundingClientRect)
            return e = e.getBoundingClientRect(), c.top = e.top, c.bottom = e.bottom || e.top + e.height, c.left = e.left, c.width = e.width || e.right - e.left, c.height = e.height || e.bottom - e.top, c
    };
    p.Util.getCSS = function(e, c, b) {
        function j(a, b) {
            var c = e.runtimeStyle && e.runtimeStyle[a], d, j = e.style;
            !/^-?[0-9]+\.?[0-9]*(?:px)?$/i.test(b) && /^-?\d/.test(b) && (d = j.left, c && (e.runtimeStyle.left = e.currentStyle.left), j.left = "fontSize" === a ? "1em" : b || 0, b = j.pixelLeft + "px", j.left = d, c && (e.runtimeStyle.left = c));
            return !/^(thin|medium|thick)$/i.test(b) ? Math.round(parseFloat(b)) + "px" : b
        }
        var a, d = c.match(/^background(Size|Position)$/);
        void 0 !== e && (w = g.defaultView.getComputedStyle(e, null));
        a = w[c];
        if (d) {
            if (a = (a || "").split(","), a = a[b || 0] || a[0] || "auto", a = p.Util.trimText(a).split(" "), !("backgroundSize" === c && (!a[0] || a[0].match(/cover|contain|auto/)))) {
                a[0] = -1 === a[0].indexOf("%") ? j(c + "X", a[0]) : a[0];
                if (a[1] === L) {
                    if ("backgroundSize" === c)
                        return a[1] = "auto", a;
                    a[1] = a[0]
                }
                a[1] = -1 === a[1].indexOf("%") ? j(c + "Y", a[1]) : a[1]
            }
        } else
            /border(Top|Bottom)(Left|Right)Radius/.test(c) && (c = a.split(" "), 1 >= c.length && (c[1] = c[0]), c[0] = parseInt(c[0], 10), c[1] = parseInt(c[1], 10), a = c);
        return a
    };
    p.Util.resizeBounds = function(e, c, b, j, a) {
        e /= c;
        !a || "auto" === a ? (a = b, b = j) : b / j < e ^ "contain" === a ? (b = j, a = j * e) : (a = b, b /= e);
        return {width: a,height: b}
    };
    p.Util.BackgroundPosition = function(e, c, b, j, a) {
        e = m("backgroundPosition", e, c, b, j, a);
        return {left: e[0],top: e[1]}
    };
    p.Util.BackgroundSize = function(e, c, b, j) {
        e = m("backgroundSize", e, c, b, j);
        return {width: e[0],height: e[1]}
    };
    p.Util.Extend = function(e, c) {
        for (var b in e)
            e.hasOwnProperty(b) && (c[b] = e[b]);
        return c
    };
    p.Util.Children = function(e) {
        var c;
        try {
            var b;
            if (e.nodeName && "IFRAME" === e.nodeName.toUpperCase())
                b = e.contentDocument || e.contentWindow.document;
            else {
                var j = e.childNodes;
                e = [];
                if (null !== j) {
                    var a = e.length, d = 0;
                    if ("number" === typeof j.length)
                        for (var g = j.length; d < g; d++)
                            e[a++] = j[d];
                    else
                        for (; j[d] !== L; )
                            e[a++] = j[d++];
                    e.length = a
                }
                b = e
            }
            c = b
        } catch (h) {
            I("html2canvas.Util.Children failed with exception: " + h.message), c = []
        }
        return c
    };
    var T = {};
    p.Util.Font = function(e, c, b) {
        if (T[e + "-" + c] !== L)
            return T[e + "-" + c];
        var j = b.createElement("div"), a = b.createElement("img"), d = b.createElement("span"), g;
        j.style.visibility = "hidden";
        j.style.fontFamily = e;
        j.style.fontSize = c;
        j.style.margin = 0;
        j.style.padding = 0;
        b.body.appendChild(j);
        a.src = "data:image/gif;base64,R0lGODlhAQABAIABAP///wAAACwAAAAAAQABAAACAkQBADs=";
        a.width = 1;
        a.height = 1;
        a.style.margin = 0;
        a.style.padding = 0;
        a.style.verticalAlign = "baseline";
        d.style.fontFamily = e;
        d.style.fontSize = c;
        d.style.margin = 0;
        d.style.padding = 0;
        d.appendChild(b.createTextNode("Hidden Text"));
        j.appendChild(d);
        j.appendChild(a);
        g = a.offsetTop - d.offsetTop + 1;
        j.removeChild(d);
        j.appendChild(b.createTextNode("Hidden Text"));
        j.style.lineHeight = "normal";
        a.style.verticalAlign = "super";
        a = {baseline: g,lineWidth: 1,middle: a.offsetTop - j.offsetTop + 1};
        T[e + "-" + c] = a;
        b.body.removeChild(j);
        return a
    };
    p.Generate = {};
    var B = [/^(-webkit-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/, /^(-o-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/, /^(-webkit-gradient)\((linear|radial),\s((?:\d{1,3}%?)\s(?:\d{1,3}%?),\s(?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)\-]+)\)$/, /^(-moz-linear-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)]+)\)$/, /^(-webkit-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/, /^(-moz-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s?([a-z\-]*)([\w\d\.\s,%\(\)]+)\)$/, /^(-o-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/];
    p.Generate.parseGradient = function(e, c) {
        var b, j, a = B.length, d, g, h, q;
        for (j = 0; j < a && !(d = e.match(B[j])); j += 1)
            ;
        if (d)
            switch (d[1]) {
                case "-webkit-linear-gradient":
                case "-o-linear-gradient":
                    b = {type: "linear",x0: null,y0: null,x1: null,y1: null,colorStops: []};
                    if (a = d[2].match(/\w+/g)) {
                        g = a.length;
                        for (j = 0; j < g; j += 1)
                            switch (a[j]) {
                                case "top":
                                    b.y0 = 0;
                                    b.y1 = c.height;
                                    break;
                                case "right":
                                    b.x0 = c.width;
                                    b.x1 = 0;
                                    break;
                                case "bottom":
                                    b.y0 = c.height;
                                    b.y1 = 0;
                                    break;
                                case "left":
                                    b.x0 = 0, b.x1 = c.width
                            }
                    }
                    null === b.x0 && null === b.x1 && (b.x0 = b.x1 = c.width / 2);
                    null === b.y0 && null === b.y1 && (b.y0 = b.y1 = c.height / 2);
                    if (a = d[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g)) {
                        g = a.length;
                        h = 1 / Math.max(g - 1, 1);
                        for (j = 0; j < g; j += 1)
                            q = a[j].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/), q[2] ? (d = parseFloat(q[2]), d = "%" === q[3] ? d / 100 : d / c.width) : d = j * h, b.colorStops.push({color: q[1],stop: d})
                    }
                    break;
                case "-webkit-gradient":
                    b = {type: "radial" === d[2] ? "circle" : d[2],x0: 0,y0: 0,x1: 0,y1: 0,colorStops: []};
                    if (a = d[3].match(/(\d{1,3})%?\s(\d{1,3})%?,\s(\d{1,3})%?\s(\d{1,3})%?/))
                        b.x0 = a[1] * c.width / 100, b.y0 = a[2] * c.height / 100, b.x1 = a[3] * c.width / 100, b.y1 = a[4] * c.height / 100;
                    if (a = d[4].match(/((?:from|to|color-stop)\((?:[0-9\.]+,\s)?(?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)\))+/g)) {
                        g = a.length;
                        for (j = 0; j < g; j += 1)
                            q = a[j].match(/(from|to|color-stop)\(([0-9\.]+)?(?:,\s)?((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\)/), d = parseFloat(q[2]), "from" === q[1] && (d = 0), "to" === q[1] && (d = 1), b.colorStops.push({color: q[3],stop: d})
                    }
                    break;
                case "-moz-linear-gradient":
                    b = {type: "linear",x0: 0,y0: 0,x1: 0,y1: 0,colorStops: []};
                    if (a = d[2].match(/(\d{1,3})%?\s(\d{1,3})%?/))
                        b.x0 = a[1] * c.width / 100, b.y0 = a[2] * c.height / 100, b.x1 = c.width - b.x0, b.y1 = c.height - b.y0;
                    if (a = d[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}%)?)+/g)) {
                        g = a.length;
                        h = 1 / Math.max(g - 1, 1);
                        for (j = 0; j < g; j += 1)
                            q = a[j].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%)?/), q[2] ? (d = parseFloat(q[2]), q[3] && (d /= 100)) : d = j * h, b.colorStops.push({color: q[1],stop: d})
                    }
                    break;
                case "-webkit-radial-gradient":
                case "-moz-radial-gradient":
                case "-o-radial-gradient":
                    b = {type: "circle",x0: 0,y0: 0,x1: c.width,y1: c.height,cx: 0,cy: 0,rx: 0,ry: 0,colorStops: []};
                    if (a = d[2].match(/(\d{1,3})%?\s(\d{1,3})%?/))
                        b.cx = a[1] * c.width / 100, b.cy = a[2] * c.height / 100;
                    a = d[3].match(/\w+/);
                    q = d[4].match(/[a-z\-]*/);
                    if (a && q)
                        switch (q[0]) {
                            case "farthest-corner":
                            case "cover":
                            case "":
                                j = Math.sqrt(Math.pow(b.cx, 2) + Math.pow(b.cy, 2));
                                a = Math.sqrt(Math.pow(b.cx, 2) + Math.pow(b.y1 - b.cy, 2));
                                g = Math.sqrt(Math.pow(b.x1 - b.cx, 2) + Math.pow(b.y1 - b.cy, 2));
                                q = Math.sqrt(Math.pow(b.x1 - b.cx, 2) + Math.pow(b.cy, 2));
                                b.rx = b.ry = Math.max(j, a, g, q);
                                break;
                            case "closest-corner":
                                j = Math.sqrt(Math.pow(b.cx, 2) + Math.pow(b.cy, 2));
                                a = Math.sqrt(Math.pow(b.cx, 2) + Math.pow(b.y1 - b.cy, 2));
                                g = Math.sqrt(Math.pow(b.x1 - b.cx, 2) + Math.pow(b.y1 - b.cy, 2));
                                q = Math.sqrt(Math.pow(b.x1 - b.cx, 2) + Math.pow(b.cy, 2));
                                b.rx = b.ry = Math.min(j, a, g, q);
                                break;
                            case "farthest-side":
                                "circle" === a[0] ? b.rx = b.ry = Math.max(b.cx, b.cy, b.x1 - b.cx, b.y1 - b.cy) : (b.type = a[0], b.rx = Math.max(b.cx, b.x1 - b.cx), b.ry = Math.max(b.cy, b.y1 - b.cy));
                                break;
                            case "closest-side":
                            case "contain":
                                "circle" === a[0] ? b.rx = b.ry = Math.min(b.cx, b.cy, b.x1 - b.cx, b.y1 - b.cy) : (b.type = a[0], b.rx = Math.min(b.cx, b.x1 - b.cx), b.ry = Math.min(b.cy, b.y1 - b.cy))
                        }
                    if (a = d[5].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g)) {
                        g = a.length;
                        h = 1 / Math.max(g - 1, 1);
                        for (j = 0; j < g; j += 1)
                            q = a[j].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/), q[2] ? (d = parseFloat(q[2]), d = "%" === q[3] ? d / 100 : d / c.width) : d = j * h, b.colorStops.push({color: q[1],stop: d})
                    }
            }
        return b
    };
    p.Generate.Gradient = function(e, c) {
        if (!(0 === c.width || 0 === c.height)) {
            var b = g.createElement("canvas"), j = b.getContext("2d"), a, d, h, m;
            b.width = c.width;
            b.height = c.height;
            if (a = p.Generate.parseGradient(e, c))
                if ("linear" === a.type) {
                    d = j.createLinearGradient(a.x0, a.y0, a.x1, a.y1);
                    h = 0;
                    for (m = a.colorStops.length; h < m; h += 1)
                        try {
                            d.addColorStop(a.colorStops[h].stop, a.colorStops[h].color)
                        } catch (q) {
                            I(["failed to add color stop: ", q, "; tried to add: ", a.colorStops[h], "; stop: ", h, "; in: ", e])
                        }
                    j.fillStyle = d;
                    j.fillRect(0, 0, c.width, c.height)
                } else if ("circle" === a.type) {
                    d = j.createRadialGradient(a.cx, a.cy, 0, a.cx, a.cy, a.rx);
                    h = 0;
                    for (m = a.colorStops.length; h < m; h += 1)
                        try {
                            d.addColorStop(a.colorStops[h].stop, a.colorStops[h].color)
                        } catch (E) {
                            I(["failed to add color stop: ", E, "; tried to add: ", a.colorStops[h], "; stop: ", h, "; in: ", e])
                        }
                    j.fillStyle = d;
                    j.fillRect(0, 0, c.width, c.height)
                } else if ("ellipse" === a.type) {
                    var P = g.createElement("canvas"), w = P.getContext("2d");
                    d = Math.max(a.rx, a.ry);
                    var y = 2 * d;
                    P.width = P.height = y;
                    d = w.createRadialGradient(a.rx, a.ry, 0, a.rx, a.ry, d);
                    h = 0;
                    for (m = a.colorStops.length; h < m; h += 1)
                        try {
                            d.addColorStop(a.colorStops[h].stop, a.colorStops[h].color)
                        } catch (B) {
                            I(["failed to add color stop: ", B, "; tried to add: ", a.colorStops[h], "; stop: ", h, "; in: ", e])
                        }
                    w.fillStyle = d;
                    w.fillRect(0, 0, y, y);
                    j.fillStyle = a.colorStops[h - 1].color;
                    j.fillRect(0, 0, b.width, b.height);
                    j.drawImage(P, a.cx - a.rx, a.cy - a.ry, 2 * a.rx, 2 * a.ry)
                }
            return b
        }
    };
    p.Generate.ListAlpha = function(e) {
        var c = "", b;
        do
            b = e % 26, c = String.fromCharCode(b + 64) + c, e /= 26;
        while (26 < 26 * e);
        return c
    };
    p.Generate.ListRoman = function(e) {
        var c = "M CM D CD C XC L XL X IX V IV I".split(" "), b = [1E3, 900, 500, 400, 100, 90, 50, 40, 10, 9, 5, 4, 1], j = "", a, d = c.length;
        if (0 >= e || 4E3 <= e)
            return e;
        for (a = 0; a < d; a += 1)
            for (; e >= b[a]; )
                e -= b[a], j += c[a];
        return j
    };
    p.Parse = function(e, c) {
        function b() {
            return Math.max(Math.max(t.body.scrollWidth, t.documentElement.scrollWidth), Math.max(t.body.offsetWidth, t.documentElement.offsetWidth), Math.max(t.body.clientWidth, t.documentElement.clientWidth))
        }
        function j() {
            return Math.max(Math.max(t.body.scrollHeight, t.documentElement.scrollHeight), Math.max(t.body.offsetHeight, t.documentElement.offsetHeight), Math.max(t.body.clientHeight, t.documentElement.clientHeight))
        }
        function a(a, b) {
            var c = parseInt(f(a, b), 10);
            return isNaN(c) ? 0 : c
        }
        function d(a, b, f, c, d, t) {
            "transparent" !== t && (a.setVariable("fillStyle", t), a.fillRect(b, f, c, d))
        }
        function m(a, b) {
            switch (b) {
                case "lowercase":
                    return a.toLowerCase();
                case "capitalize":
                    return a.replace(/(^|\s|:|-|\(|\))([a-z])/g, function(a, b, l) {
                        if (0 < a.length)
                            return b + l.toUpperCase()
                    });
                case "uppercase":
                    return a.toUpperCase();
                default:
                    return a
            }
        }
        function J(a, b, c, d) {
            var v = f(b, "fontWeight"), u = f(b, "fontFamily"), x = f(b, "fontSize");
            switch (parseInt(v, 10)) {
                case 401:
                    v = "bold";
                    break;
                case 400:
                    v = "normal"
            }
            a.setVariable("fillStyle", d);
            a.setVariable("font", [f(b, "fontStyle"), f(b, "fontVariant"), v, x, u].join(" "));
            a.setVariable("textAlign", "left");
            if ("none" !== c)
                return p.Util.Font(u, x, t)
        }
        function q(a, b, u) {
            var x = u.ctx, e = f(a, "color"), q = f(a, "textDecoration");
            u = f(a, "textAlign");
            var j, h, g = b, ca = 0;
            if (0 < p.Util.trimText(b.nodeValue).length) {
                b.nodeValue = m(b.nodeValue, f(a, "textTransform"));
                u = u.replace(["-webkit-auto"], ["auto"]);
                var s;
                if (s = !c.letterRendering) {
                    if (u = /^(left|right|justify|auto)$/.test(u))
                        u = f(a, "letterSpacing"), u = /^(normal|none|0px)$/.test(u);
                    s = u
                }
                h = s ? b.nodeValue.split(/(\b| )/) : b.nodeValue.split("");
                j = J(x, a, q, e);
                c.chinese && h.forEach(function(a, b) {
                    /.*[\u4E00-\u9FA5].*$/.test(a) && (a = a.split(""), a.unshift(b, 1), h.splice.apply(h, a))
                });
                h.forEach(function(a, b) {
                    var l;
                    l = b < h.length - 1;
                    var f;
                    if (v.rangeBounds) {
                        if ("none" !== q || 0 !== p.Util.trimText(a).length) {
                            l = g;
                            f = ca;
                            var r = t.createRange();
                            r.setStart(l, f);
                            r.setEnd(l, f + a.length);
                            f = r.getBoundingClientRect()
                        }
                        ca += a.length
                    } else if (g && "string" === typeof g.nodeValue) {
                        l = l ? g.splitText(a.length) : null;
                        var c = g;
                        f = c.parentNode;
                        var r = t.createElement("wrapper"), u = c.cloneNode(!0);
                        r.appendChild(c.cloneNode(!0));
                        f.replaceChild(r, c);
                        c = p.Util.Bounds(r);
                        f.replaceChild(u, r);
                        f = c;
                        g = l
                    }
                    if (l = f)
                        switch (f = l.left, r = l.bottom, null !== a && 0 < p.Util.trimText(a).length && x.fillText(a, f, r), q) {
                            case "underline":
                                d(x, l.left, Math.round(l.top + j.baseline + j.lineWidth), l.width, 1, e);
                                break;
                            case "overline":
                                d(x, l.left, Math.round(l.top), l.width, 1, e);
                                break;
                            case "line-through":
                                d(x, l.left, Math.ceil(l.top + j.middle + j.lineWidth), l.width, 1, e)
                        }
                })
            }
        }
        function E(a) {
            return (a = e[a]) && !0 === a.succeeded ? a.img : !1
        }
        function P(a, b) {
            var f = Math.max(a.left, b.left), c = Math.max(a.top, b.top), d = Math.min(a.left + a.width, b.left + b.width), t = Math.min(a.top + a.height, b.top + b.height);
            return {left: f,top: c,width: d - f,height: t - c}
        }
        function w(b, f, c, d, t) {
            var u = a(f, "paddingLeft"), v = a(f, "paddingTop"), x = a(f, "paddingRight");
            f = a(f, "paddingBottom");
            n(b, c, 0, 0, c.width, c.height, d.left + u + t[3].width, d.top + v + t[0].width, d.width - (t[1].width + t[3].width + u + x), d.height - (t[0].width + t[2].width + v + f))
        }
        function y(a, b, f, c) {
            var d = function(a, b, f) {
                return {x: a.x + (b.x - a.x) * f,y: a.y + (b.y - a.y) * f}
            };
            return {start: a,startControl: b,endControl: f,end: c,subdivide: function(t) {
                    var u = d(a, b, t), v = d(b, f, t), x = d(f, c, t), e = d(u, v, t), v = d(v, x, t);
                    t = d(e, v, t);
                    return [y(a, u, e, t), y(t, v, x, c)]
                },curveTo: function(a) {
                    a.push(["bezierCurve", b.x, b.y, f.x, f.y, c.x, c.y])
                },curveToReversed: function(c) {
                    c.push(["bezierCurve", f.x, f.y, b.x, b.y, a.x, a.y])
                }}
        }
        function B(a, b, f, c, d, t, u) {
            0 < b[0] || 0 < b[1] ? (a.push(["line", c[0].start.x, c[0].start.y]), c[0].curveTo(a), c[1].curveTo(a)) : a.push(["line", t, u]);
            (0 < f[0] || 0 < f[1]) && a.push(["line", d[0].start.x, d[0].start.y])
        }
        function M(a, b, f, c, d, t, u) {
            var v = [];
            0 < b[0] || 0 < b[1] ? (v.push(["line", c[1].start.x, c[1].start.y]), c[1].curveTo(v)) : v.push(["line", a.c1[0], a.c1[1]]);
            0 < f[0] || 0 < f[1] ? (v.push(["line", t[0].start.x, t[0].start.y]), t[0].curveTo(v), v.push(["line", u[0].end.x, u[0].end.y]), u[0].curveToReversed(v)) : (v.push(["line", a.c2[0], a.c2[1]]), v.push(["line", a.c3[0], a.c3[1]]));
            0 < b[0] || 0 < b[1] ? (v.push(["line", d[1].end.x, d[1].end.y]), d[1].curveToReversed(v)) : v.push(["line", a.c4[0], a.c4[1]]);
            return v
        }
        function C(a, b) {
            var f = a.drawShape();
            b.forEach(function(a, b) {
                f[0 === b ? "moveTo" : a[0] + "To"].apply(null, a.slice(1))
            });
            return f
        }
        function G(a, b, c) {
            var d = t.createElement("valuewrap");
            "lineHeight textAlign fontFamily color fontSize paddingLeft paddingTop width height border borderLeftWidth borderTopWidth".split(" ").forEach(function(b) {
                try {
                    d.style[b] = f(a, b)
                } catch (c) {
                    I("html2canvas: Parse: Exception caught in renderFormValue: " + c.message)
                }
            });
            d.style.borderColor = "black";
            d.style.borderStyle = "solid";
            d.style.display = "block";
            d.style.position = "absolute";
            if (/^(submit|reset|button|text|password)$/.test(a.type) || "SELECT" === a.nodeName)
                d.style.lineHeight = f(a, "height");
            d.style.top = b.top + "px";
            d.style.left = b.left + "px";
            b = "SELECT" === a.nodeName ? (a.options[a.selectedIndex] || 0).text : a.value;
            b || (b = a.placeholder);
            b = t.createTextNode(b);
            d.appendChild(b);
            W.appendChild(d);
            q(a, b, c);
            W.removeChild(d)
        }
        function n(a) {
            a.drawImage.apply(a, Array.prototype.slice.call(arguments, 1))
        }
        function s(a, b) {
            var f = h.getComputedStyle(a, b);
            if (f && f.content && !("none" === f.content || "-moz-alt-content" === f.content)) {
                var c = f.content + "", d = c.substr(0, 1);
                d === c.substr(c.length - 1) && d.match(/'|"/) && (c = c.substr(1, c.length - 2));
                var d = "url" === c.substr(0, 3), t = g.createElement(d ? "img" : "span");
                t.className = u + "-before " + u + "-after";
                Object.keys(f).filter(H).forEach(function(a) {
                    t.style[a] = f[a]
                });
                d ? t.src = p.Util.parseBackgroundImage(c)[0].args[0] : t.innerHTML = c;
                return t
            }
        }
        function H(a) {
            return isNaN(h.parseInt(a, 10))
        }
        function R(a, b, f, c) {
            var d = Math.round(c.left + f.left);
            f = Math.round(c.top + f.top);
            a.createPattern(b);
            a.translate(d, f);
            a.fill();
            a.translate(-d, -f)
        }
        function S(a, b, f, c, d, t, v, u) {
            var x = [];
            x.push(["line", Math.round(d), Math.round(t)]);
            x.push(["line", Math.round(d + v), Math.round(t)]);
            x.push(["line", Math.round(d + v), Math.round(u + t)]);
            x.push(["line", Math.round(d), Math.round(u + t)]);
            C(a, x);
            a.save();
            a.clip();
            R(a, b, f, c);
            a.restore()
        }
        function Z(a, b, c, d, v) {
            var u = p.Util.BackgroundSize(a, b, d, v), x = p.Util.BackgroundPosition(a, b, d, v, u);
            a = f(a, "backgroundRepeat").split(",").map(function(a) {
                return a.trim()
            });
            if (!(d.width === u.width && d.height === u.height)) {
                var e, q = t.createElement("canvas");
                q.width = u.width;
                q.height = u.height;
                e = q.getContext("2d");
                n(e, d, 0, 0, d.width, d.height, 0, 0, u.width, u.height);
                d = q
            }
            a = a[v] || a[0];
            switch (a) {
                case "repeat-x":
                    S(c, d, x, b, b.left, b.top + x.top, 99999, d.height);
                    break;
                case "repeat-y":
                    S(c, d, x, b, b.left + x.left, b.top, d.width, 99999);
                    break;
                case "no-repeat":
                    S(c, d, x, b, b.left + x.left, b.top + x.top, d.width, d.height);
                    break;
                default:
                    R(c, d, x, {top: b.top,left: b.left,width: d.width,height: d.height})
            }
        }
        function T(l, v, x) {
            var e, q, h, g, ca, m, H, A, n = p.Util.Bounds(l), R, y = ka.test(l.nodeName) ? "#efefef" : f(l, "backgroundColor"), W;
            W = !v ? b() : n.width;
            var z = !v ? j() : n.height, X = [];
            W = {storage: X,width: W,height: z,clip: function() {
                    X.push({type: "function",name: "clip",arguments: arguments})
                },translate: function() {
                    X.push({type: "function",name: "translate",arguments: arguments})
                },fill: function() {
                    X.push({type: "function",name: "fill",arguments: arguments})
                },save: function() {
                    X.push({type: "function",name: "save",arguments: arguments})
                },restore: function() {
                    X.push({type: "function",name: "restore",arguments: arguments})
                },fillRect: function() {
                    X.push({type: "function",name: "fillRect",arguments: arguments})
                },createPattern: function() {
                    X.push({type: "function",name: "createPattern",arguments: arguments})
                },drawShape: function() {
                    var a = [];
                    X.push({type: "function",name: "drawShape",arguments: a});
                    return {moveTo: function() {
                            a.push({name: "moveTo",arguments: arguments})
                        },lineTo: function() {
                            a.push({name: "lineTo",arguments: arguments})
                        },arcTo: function() {
                            a.push({name: "arcTo",arguments: arguments})
                        },bezierCurveTo: function() {
                            a.push({name: "bezierCurveTo",arguments: arguments})
                        },quadraticCurveTo: function() {
                            a.push({name: "quadraticCurveTo",arguments: arguments})
                        }}
                },drawImage: function() {
                    X.push({type: "function",name: "drawImage",arguments: arguments})
                },fillText: function() {
                    X.push({type: "function",name: "fillText",arguments: arguments})
                },setVariable: function(a, b) {
                    X.push({type: "variable",name: a,arguments: b})
                }};
            e = f(l, "zIndex");
            (z = v ? v.zIndex : null) ? "auto" !== e && (e = {zindex: e,children: []}, z.children.push(e), z = e) : z = e = {zindex: 0,children: []};
            e = f(l, "opacity") * (v ? v.opacity : 1);
            W.setVariable("globalAlpha", e);
            var S = f(l, "position"), ja;
            ja = ["Top", "Right", "Bottom", "Left"].map(function(b) {
                return {width: a(l, "border" + b + "Width"),color: f(l, "border" + b + "Color")}
            });
            v = {ctx: W,zIndex: z,opacity: e,cssPosition: S,borders: ja,clip: v && v.clip ? p.Util.Extend({}, v.clip) : null};
            !0 === c.useOverflow && (!0 === /(hidden|scroll|auto)/.test(f(l, "overflow")) && !1 === /(BODY)/i.test(l.nodeName)) && (v.clip = v.clip ? P(v.clip, n) : n);
            v.zIndex.children.push(v);
            var z = v.borders, ba = v.ctx;
            W = v.clip;
            e = {left: n.left + z[3].width,top: n.top + z[0].width,width: n.width - (z[1].width + z[3].width),height: n.height - (z[0].width + z[2].width)};
            W && (e = P(e, W));
            W = e;
            S = n.left;
            ja = n.top;
            var ta = n.width, L = n.height, U, N, D, Q, $, Y, K;
            K = ["TopLeft", "TopRight", "BottomRight", "BottomLeft"].map(function(a) {
                return f(l, "border" + a + "Radius")
            });
            var ea = n.left;
            A = n.top;
            m = n.width;
            H = n.height;
            q = K[0][0];
            h = K[0][1];
            g = K[1][0];
            ca = K[1][1];
            Q = K[2][0];
            $ = K[2][1];
            U = K[3][0];
            N = K[3][1];
            var la = m - g, ga = H - Q, qa = m - $;
            D = H - N;
            e = ia(ea, A, q, h).topLeft.subdivide(0.5);
            q = ia(ea + z[3].width, A + z[0].width, Math.max(0, q - z[3].width), Math.max(0, h - z[0].width)).topLeft.subdivide(0.5);
            h = ia(ea + la, A, g, ca).topRight.subdivide(0.5);
            g = ia(ea + Math.min(la, m + z[3].width), A + z[0].width, la > m + z[3].width ? 0 : g - z[3].width, ca - z[0].width).topRight.subdivide(0.5);
            ca = ia(ea + qa, A + ga, $, Q).bottomRight.subdivide(0.5);
            m = ia(ea + Math.min(qa, m + z[3].width), A + Math.min(ga, H + z[0].width), Math.max(0, $ - z[1].width), Math.max(0, Q - z[2].width)).bottomRight.subdivide(0.5);
            H = ia(ea, A + D, U, N).bottomLeft.subdivide(0.5);
            A = ia(ea + z[3].width, A + D, Math.max(0, U - z[3].width), Math.max(0, N - z[2].width)).bottomLeft.subdivide(0.5);
            ga = [];
            switch (f(l, "backgroundClip")) {
                case "content-box":
                case "padding-box":
                    B(ga, K[0], K[1], q, g, n.left + z[3].width, n.top + z[0].width);
                    B(ga, K[1], K[2], g, m, n.left + n.width - z[1].width, n.top + z[0].width);
                    B(ga, K[2], K[3], m, A, n.left + n.width - z[1].width, n.top + n.height - z[2].width);
                    B(ga, K[3], K[0], A, q, n.left + z[3].width, n.top + n.height - z[2].width);
                    break;
                default:
                    B(ga, K[0], K[1], e, h, n.left, n.top), B(ga, K[1], K[2], h, ca, n.left + n.width, n.top), B(ga, K[2], K[3], ca, H, n.left + n.width, n.top + n.height), B(ga, K[3], K[0], H, e, n.left, n.top + n.height)
            }
            ea = [];
            for (U = 0; 4 > U; U++)
                if (0 < z[U].width) {
                    N = S;
                    D = ja;
                    Q = ta;
                    $ = L - z[2].width;
                    switch (U) {
                        case 0:
                            $ = z[0].width;
                            Y = M({c1: [N, D],c2: [N + Q, D],c3: [N + Q - z[1].width, D + $],c4: [N + z[3].width, D + $]}, K[0], K[1], e, q, h, g);
                            break;
                        case 1:
                            N = S + ta - z[1].width;
                            Q = z[1].width;
                            Y = M({c1: [N + Q, D],c2: [N + Q, D + $ + z[2].width],c3: [N, D + $],c4: [N, D + z[0].width]}, K[1], K[2], h, g, ca, m);
                            break;
                        case 2:
                            D = D + L - z[2].width;
                            $ = z[2].width;
                            Y = M({c1: [N + Q, D + $],c2: [N, D + $],c3: [N + z[3].width, D],c4: [N + Q - z[2].width, D]}, K[2], K[3], ca, m, H, A);
                            break;
                        case 3:
                            Q = z[3].width, Y = M({c1: [N, D + $ + z[2].width],c2: [N, D],c3: [N + Q, D + z[0].width],c4: [N + Q, D + $]}, K[3], K[0], H, A, e, q)
                    }
                    ea.push({args: Y,color: z[U].color})
                }
            C(ba, ga);
            ba.save();
            ba.clip();
            if (0 < W.height && 0 < W.width) {
                d(ba, n.left, n.top, n.width, n.height, y);
                y = f(l, "backgroundImage");
                Y = p.Util.parseBackgroundImage(y);
                for (S = Y.length; S--; )
                    y = Y[S], y.args && 0 !== y.args.length && ((e = E("url" === y.method ? y.args[0] : y.value)) ? Z(l, W, ba, e, S) : I("html2canvas: Error loading background:", y))
            }
            ba.restore();
            ea.forEach(function(a) {
                var b = a.args;
                a = a.color;
                "transparent" !== a && (ba.setVariable("fillStyle", a), C(ba, b), ba.fill())
            });
            if (!x && (x = s(l, ":before"), y = s(l, ":after"), x || y))
                x && (l.className += " " + u + "-before", l.parentNode.insertBefore(x, l), V(x, v, !0), l.parentNode.removeChild(x), l.className = l.className.replace(u + "-before", "").trim()), y && (l.className += " " + u + "-after", l.appendChild(y), V(y, v, !0), l.removeChild(y), l.className = l.className.replace(u + "-after", "").trim());
            switch (l.nodeName) {
                case "IMG":
                    (R = E(l.getAttribute("src"))) ? w(ba, l, R, n, z) : I("html2canvas: Error loading <img>:" + l.getAttribute("src"));
                    break;
                case "INPUT":
                    /^(text|url|email|submit|button|reset)$/.test(l.type) && 0 < (l.value || l.placeholder).length && G(l, n, v);
                    break;
                case "TEXTAREA":
                    0 < (l.value || l.placeholder || "").length && G(l, n, v);
                    break;
                case "SELECT":
                    0 < (l.options || l.placeholder || "").length && G(l, n, v);
                    break;
                case "LI":
                    var aa, n = v.ctx;
                    R = f(l, "listStyleType");
                    if (/^(decimal|decimal-leading-zero|upper-alpha|upper-latin|upper-roman|lower-alpha|lower-greek|lower-latin|lower-roman)$/i.test(R)) {
                        x = -1;
                        y = 1;
                        Y = l.parentNode.childNodes;
                        if (l.parentNode) {
                            for (; Y[++x] !== l; )
                                1 === Y[x].nodeType && y++;
                            x = y
                        } else
                            x = -1;
                        switch (R) {
                            case "decimal":
                                aa = x;
                                break;
                            case "decimal-leading-zero":
                                aa = 1 === x.toString().length ? "0" + x.toString() : x.toString();
                                break;
                            case "upper-roman":
                                aa = p.Generate.ListRoman(x);
                                break;
                            case "lower-roman":
                                aa = p.Generate.ListRoman(x).toLowerCase();
                                break;
                            case "lower-alpha":
                                aa = p.Generate.ListAlpha(x).toLowerCase();
                                break;
                            case "upper-alpha":
                                aa = p.Generate.ListAlpha(x)
                        }
                        aa += ". ";
                        x = t.createElement("boundelement");
                        x.style.display = "inline";
                        y = l.style.listStyleType;
                        l.style.listStyleType = "none";
                        x.appendChild(t.createTextNode(aa));
                        l.insertBefore(x, l.firstChild);
                        R = p.Util.Bounds(x);
                        l.removeChild(x);
                        l.style.listStyleType = y;
                        J(n, l, "none", f(l, "color"));
                        "inside" === f(l, "listStylePosition") && (n.setVariable("textAlign", "left"), x = W.left, R = R.bottom, null !== aa && 0 < p.Util.trimText(aa).length && n.fillText(aa, x, R))
                    }
                    break;
                case "CANVAS":
                    w(ba, l, l, n, z)
            }
            return v
        }
        function V(a, b, c) {
            "none" !== f(a, "display") && ("hidden" !== f(a, "visibility") && !a.hasAttribute("data-html2canvas-ignore")) && (b = T(a, b, c) || b, ka.test(a.nodeName) || p.Util.Children(a).forEach(function(f) {
                1 === f.nodeType ? V(f, b, c) : 3 === f.nodeType && q(a, f, b)
            }))
        }
        h.scroll(0, 0);
        var x = c.elements === L ? g.body : c.elements[0], t = x.ownerDocument, v = p.Util.Support(c, t), ka = RegExp("(" + c.ignoreElements + ")"), W = t.body, f = p.Util.getCSS, u = "___html2canvas___pseudoelement", ca = t.createElement("style");
        ca.innerHTML = "." + u + '-before:before { content: "" !important; display: none !important; }.' + u + '-after:after { content: "" !important; display: none !important; }';
        W.appendChild(ca);
        e = e || {};
        var ia, ba = 4 * ((Math.sqrt(2) - 1) / 3);
        ia = function(a, b, f, c) {
            var d = f * ba, v = c * ba;
            f = a + f;
            c = b + c;
            return {topLeft: y({x: a,y: c}, {x: a,y: c - v}, {x: f - d,y: b}, {x: f,y: b}),topRight: y({x: a,y: b}, {x: a + d,y: b}, {x: f,y: c - v}, {x: f,y: c}),bottomRight: y({x: f,y: b}, {x: f,y: b + v}, {x: a + d,y: c}, {x: a,y: c}),bottomLeft: y({x: f,y: c}, {x: f - d,y: c}, {x: a,y: b + v}, {x: a,y: b})}
        };
        var ja = T(x, null);
        if (v.svgRendering) {
            var D = g.documentElement, N = function(a) {
                a = p.Util.Children(a);
                var b = a.length, f, c, d, v, t;
                for (t = 0; t < b; t += 1)
                    if (v = a[t], 3 === v.nodeType)
                        Y += v.nodeValue.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                    else if (1 === v.nodeType && !/^(script|meta|title)$/.test(v.nodeName.toLowerCase())) {
                        Y += "<" + v.nodeName.toLowerCase();
                        if (v.hasAttributes()) {
                            f = v.attributes;
                            d = f.length;
                            for (c = 0; c < d; c += 1)
                                Y += " " + f[c].name + '="' + f[c].value + '"'
                        }
                        Y += ">";
                        N(v);
                        Y += "</" + v.nodeName.toLowerCase() + ">"
                    }
            }, A = new Image, X = b(), ta = j(), Y = "";
            N(D);
            A.src = ["data:image/svg+xml,", "<svg xmlns='http://www.w3.org/2000/svg' version='1.1' width='" + X + "' height='" + ta + "'>", "<foreignObject width='" + X + "' height='" + ta + "'>", "<html xmlns='http://www.w3.org/1999/xhtml' style='margin:0;'>", Y.replace(/\#/g, "%23"), "</html></foreignObject></svg>"].join("");
            A.onload = function() {
                ja.svgRender = A
            }
        }
        Array.prototype.slice.call(x.children, 0).forEach(function(a) {
            V(a, ja)
        });
        ja.backgroundColor = f(g.documentElement, "backgroundColor");
        W.removeChild(ca);
        return ja
    };
    p.Preload = function(e) {
        function c() {
            I("html2canvas: start: images: " + q.numLoaded + " / " + q.numTotal + " (failed: " + q.numFailed + ")");
            !q.firstRun && q.numLoaded >= q.numTotal && (I("Finished loading images: # " + q.numTotal + " (failed: " + q.numFailed + ")"), "function" === typeof e.complete && e.complete(q))
        }
        function b(a, b, d) {
            var g, j = e.proxy, n;
            G.href = a;
            a = G.href;
            g = "html2canvas_" + y++;
            d.callbackname = g;
            j = -1 < j.indexOf("?") ? j + "&" : j + "?";
            j += "url=" + encodeURIComponent(a) + "&callback=" + g;
            n = B.createElement("script");
            h[g] = function(a) {
                "error:" === a.substring(0, 6) ? (d.succeeded = !1, q.numLoaded++, q.numFailed++, c()) : (J(b, d), b.src = a);
                h[g] = L;
                try {
                    delete h[g]
                } catch (t) {
                }
                n.parentNode.removeChild(n);
                n = null;
                delete d.script;
                delete d.callbackname
            };
            n.setAttribute("type", "text/javascript");
            n.setAttribute("src", j);
            d.script = n;
            h.document.body.appendChild(n)
        }
        function j(a, b) {
            var c = h.getComputedStyle(a, b), e = c.content;
            "url" === e.substr(0, 3) && D.loadImage(p.Util.parseBackgroundImage(e)[0].args[0]);
            d(c.backgroundImage, a)
        }
        function a(a) {
            return a && a.method && a.args && 0 < a.args.length
        }
        function d(b, d) {
            var e;
            p.Util.parseBackgroundImage(b).filter(a).forEach(function(a) {
                if ("url" === a.method)
                    D.loadImage(a.args[0]);
                else if (a.method.match(/\-?gradient$/)) {
                    e === L && (e = p.Util.Bounds(d));
                    a = a.value;
                    var b = p.Generate.Gradient(a, e);
                    b !== L && (q[a] = {img: b,succeeded: !0}, q.numTotal++, q.numLoaded++, c())
                }
            })
        }
        function m(a) {
            var b = !1;
            try {
                p.Util.Children(a).forEach(function(a) {
                    m(a)
                })
            } catch (c) {
            }
            try {
                b = a.nodeType
            } catch (e) {
                b = !1, I("html2canvas: failed to access some element's nodeType - Exception: " + e.message)
            }
            if (1 === b || b === L) {
                j(a, ":before");
                j(a, ":after");
                try {
                    d(p.Util.getCSS(a, "backgroundImage"), a)
                } catch (q) {
                    I("html2canvas: failed to get background-image - Exception: " + q.message)
                }
                d(a)
            }
        }
        function J(a, d) {
            a.onload = function() {
                d.timer !== L && h.clearTimeout(d.timer);
                q.numLoaded++;
                d.succeeded = !0;
                a.onerror = a.onload = null;
                c()
            };
            a.onerror = function() {
                if ("anonymous" === a.crossOrigin && (h.clearTimeout(d.timer), e.proxy)) {
                    var g = a.src;
                    a = new Image;
                    d.img = a;
                    a.src = g;
                    b(a.src, a, d);
                    return
                }
                q.numLoaded++;
                q.numFailed++;
                d.succeeded = !1;
                a.onerror = a.onload = null;
                c()
            }
        }
        var q = {numLoaded: 0,numFailed: 0,numTotal: 0,cleanupDone: !1}, E, D, w, y = 0;
        w = e.elements[0] || g.body;
        var B = w.ownerDocument, M = B.images, C = M.length, G = B.createElement("a"), n;
        n = (new Image).crossOrigin !== L;
        var s;
        G.href = h.location.href;
        E = G.protocol + G.host;
        D = {loadImage: function(a) {
                var c, d;
                a && q[a] === L && (c = new Image, a.match(/data:image\/.*;base64,/i) ? (c.src = a.replace(/url\(['"]{0,}|['"]{0,}\)$/ig, ""), d = q[a] = {img: c}, q.numTotal++, J(c, d)) : (G.href = a, G.href = G.href, G.protocol + G.host === E || !0 === e.allowTaint ? (d = q[a] = {img: c}, q.numTotal++, J(c, d), c.src = a) : n && !e.allowTaint && e.useCORS ? (c.crossOrigin = "anonymous", d = q[a] = {img: c}, q.numTotal++, J(c, d), c.src = a, c.customComplete = function() {
                    if (this.img.complete)
                        this.img.onerror();
                    else
                        this.timer = h.setTimeout(this.img.customComplete, 100)
                }.bind(d), c.customComplete()) : e.proxy && (d = q[a] = {img: c}, q.numTotal++, b(a, c, d))))
            },cleanupDOM: function(a) {
                var b, d;
                if (!q.cleanupDone) {
                    a && "string" === typeof a ? I("html2canvas: Cleanup because: " + a) : I("html2canvas: Cleanup after timeout: " + e.timeout + " ms.");
                    for (d in q)
                        if (q.hasOwnProperty(d) && (b = q[d], "object" === typeof b && b.callbackname && b.succeeded === L)) {
                            h[b.callbackname] = L;
                            try {
                                delete h[b.callbackname]
                            } catch (j) {
                            }
                            b.script && b.script.parentNode && (b.script.setAttribute("src", "about:blank"), b.script.parentNode.removeChild(b.script));
                            q.numLoaded++;
                            q.numFailed++;
                            I("html2canvas: Cleaned up failed img: '" + d + "' Steps: " + q.numLoaded + " / " + q.numTotal)
                        }
                    h.stop !== L ? h.stop() : g.execCommand !== L && g.execCommand("Stop", !1);
                    g.close !== L && g.close();
                    q.cleanupDone = !0;
                    a && "string" === typeof a || c()
                }
            },renderingDone: function() {
                s && h.clearTimeout(s)
            }};
        0 < e.timeout && (s = h.setTimeout(D.cleanupDOM, e.timeout));
        I("html2canvas: Preload starts: finding background-images");
        q.firstRun = !0;
        m(w);
        I("html2canvas: Preload: Finding images");
        for (w = 0; w < C; w += 1)
            D.loadImage(M[w].getAttribute("src"));
        q.firstRun = !1;
        I("html2canvas: Preload: Done.");
        q.numTotal === q.numLoaded && c();
        return D
    };
    p.Renderer = function(e, c) {
        var b = c.renderer;
        if ("string" === typeof c.renderer && p.Renderer[b] !== L)
            b = p.Renderer[b](c);
        else if ("function" === typeof b)
            b = b(c);
        else
            throw Error("Unknown renderer");
        if ("function" !== typeof b)
            throw Error("Invalid renderer defined");
        var j = g, a = [], d = function(b) {
            var c = [], e = [];
            b.children.forEach(function(b) {
                b.children && 0 < b.children.length ? (c.push(b), e.push(b.zindex)) : a.push(b)
            });
            e.sort(function(a, b) {
                return a - b
            });
            e.forEach(function(a) {
                var b;
                c.some(function(c, d) {
                    b = d;
                    return c.zindex === a
                });
                d(c.splice(b, 1)[0])
            })
        };
        d(e.zIndex);
        return b(e, c, j, a, p)
    };
    p.Util.Support = function(e, c) {
        function b() {
            var a = new Image, b = c.createElement("canvas"), d = b.getContext === L ? !1 : b.getContext("2d");
            if (!1 === d)
                return !1;
            b.width = b.height = 10;
            a.src = "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='10' height='10'><foreignObject width='10' height='10'><div xmlns='http://www.w3.org/1999/xhtml' style='width:10;height:10;'>sup</div></foreignObject></svg>";
            try {
                d.drawImage(a, 0, 0), b.toDataURL()
            } catch (e) {
                return !1
            }
            I("html2canvas: Parse: SVG powered rendering available");
            return !0
        }
        var g, a, d = !1;
        c.createRange && (g = c.createRange(), g.getBoundingClientRect && (a = c.createElement("boundtest"), a.style.height = "123px", a.style.display = "block", c.body.appendChild(a), g.selectNode(a), g = g.getBoundingClientRect(), g = g.height, 123 === g && (d = !0), c.body.removeChild(a)));
        return {rangeBounds: d,svgRendering: e.svgRendering && b()}
    };
    h.html2canvas = function(e, c) {
        e = e.length ? e : [e];
        var b, g, a = {logging: !1,elements: e,background: "#fff",proxy: null,timeout: 0,useCORS: !1,allowTaint: !1,svgRendering: !1,ignoreElements: "IFRAME|OBJECT|PARAM",useOverflow: !0,letterRendering: !1,chinese: !1,width: null,height: null,taintTest: !0,renderer: "Canvas"}, a = p.Util.Extend(c, a);
        p.logging = a.logging;
        a.complete = function(c) {
            if (!("function" === typeof a.onpreloaded && !1 === a.onpreloaded(c)) && (b = p.Parse(c, a), !("function" === typeof a.onparsed && !1 === a.onparsed(b)) && (g = p.Renderer(b, a), "function" === typeof a.onrendered)))
                a.onrendered(g)
        };
        h.setTimeout(function() {
            p.Preload(a)
        }, 0);
        return {render: function(b, c) {
                return p.Renderer(b, p.Util.Extend(c, a))
            },parse: function(b, c) {
                return p.Parse(b, p.Util.Extend(c, a))
            },preload: function(b) {
                return p.Preload(p.Util.Extend(b, a))
            },log: I}
    };
    h.html2canvas.log = I;
    h.html2canvas.Renderer = {Canvas: L};
    p.Renderer.Canvas = function(e) {
        function c(c, g) {
            switch (g.type) {
                case "variable":
                    c[g.name] = g.arguments;
                    break;
                case "function":
                    if ("createPattern" === g.name) {
                        if (0 < g.arguments[0].width && 0 < g.arguments[0].height)
                            try {
                                c.fillStyle = c.createPattern(g.arguments[0], "repeat")
                            } catch (m) {
                                I("html2canvas: Renderer: Error creating pattern", m.message)
                            }
                    } else if ("drawShape" === g.name) {
                        var p = g.arguments;
                        c.beginPath();
                        p.forEach(function(a) {
                            c[a.name].apply(c, a.arguments)
                        });
                        c.closePath()
                    } else if ("drawImage" === g.name) {
                        if (0 < g.arguments[8] && 0 < g.arguments[7]) {
                            if (!(p = !e.taintTest))
                                if (p = e.taintTest)
                                    a: {
                                        if (-1 === h.indexOf(g.arguments[0].src)) {
                                            d.drawImage(g.arguments[0], 0, 0);
                                            try {
                                                d.getImageData(0, 0, 1, 1)
                                            } catch (w) {
                                                a = b.createElement("canvas");
                                                d = a.getContext("2d");
                                                p = !1;
                                                break a
                                            }
                                            h.push(g.arguments[0].src)
                                        }
                                        p = !0
                                    }
                            p && c.drawImage.apply(c, g.arguments)
                        }
                    } else
                        c[g.name].apply(c, g.arguments)
            }
        }
        e = e || {};
        var b = g, h = [], a = g.createElement("canvas"), d = a.getContext("2d"), m = e.canvas || b.createElement("canvas");
        return function(a, b, d, e, g) {
            var h = m.getContext("2d"), j, p;
            m.width = m.style.width = b.width || a.ctx.width;
            m.height = m.style.height = b.height || a.ctx.height;
            j = h.fillStyle;
            h.fillStyle = ("transparent" === a.backgroundColor || "rgba(0, 0, 0, 0)" === a.backgroundColor) && b.background !== L ? b.background : a.backgroundColor;
            h.fillRect(0, 0, m.width, m.height);
            h.fillStyle = j;
            if (b.svgRendering && a.svgRender !== L)
                h.drawImage(a.svgRender, 0, 0);
            else {
                j = 0;
                for (p = e.length; j < p; j += 1)
                    a = e.splice(0, 1)[0], a.canvasPosition = a.canvasPosition || {}, h.textBaseline = "bottom", a.clip && (h.save(), h.beginPath(), h.rect(a.clip.left, a.clip.top, a.clip.width, a.clip.height), h.clip()), a.ctx.storage && a.ctx.storage.forEach(c.bind(null, h)), a.clip && h.restore()
            }
            I("html2canvas: Renderer: Canvas renderer done - returning canvas obj");
            p = b.elements.length;
            return 1 === p && "object" === typeof b.elements[0] && "BODY" !== b.elements[0].nodeName ? (b = g.Util.Bounds(b.elements[0]), d = d.createElement("canvas"), d.width = b.width, d.height = b.height, h = d.getContext("2d"), h.drawImage(m, b.left, b.top, b.width, b.height, 0, 0, b.width, b.height), m = null, d) : m
        }
    }
})(window, document);
(function(h) {
    h.fn.html2canvas = function(g) {
        function L(g, w) {
            window.clearTimeout(p);
            p = window.setTimeout(function() {
                m.fadeOut(function() {
                    m.remove();
                    m = null
                })
            }, w || 2E3);
            m && m.remove();
            m = h("<div />").html(g).css({margin: 0,padding: 10,background: "#000",opacity: 0.7,position: "fixed",top: 10,right: 10,fontFamily: "Tahoma",color: "#fff",fontSize: 12,borderRadius: 12,width: "auto",height: "auto",textAlign: "center",textDecoration: "none",display: "none"}).appendTo(document.body).fadeIn();
            I.log(g)
        }
        g && (g.profile && window.console && window.console.profile) && console.profile();
        var I, m = null, p = !1, w = (new Date).getTime();
        g = g || {};
        g.onrendered = g.onrendered || function(m) {
            var p = h(m);
            m = new Date;
            g && (g.profile && window.console && window.console.profileEnd) && console.profileEnd();
            p.css({position: "absolute",left: 0,top: 0}).appendTo(document.body);
            p.siblings().toggle();
            h(window).click(function() {
                p.toggle().siblings().toggle();
                L("Canvas Render " + (p.is(":visible") ? "visible" : "hidden"))
            });
            L("Screenshot created in " + (m.getTime() - w) + " ms<br />", 4E3);
            try {
                p[0].toDataURL()
            } catch (B) {
                "canvas" === p[0].nodeName.toLowerCase() && alert("Canvas is tainted, unable to read data")
            }
        };
        I = html2canvas(this, g)
    }
})(jQuery);
(function(h, g) {
    function L(a, b, d) {
        for (var g = [], e = 0; e < a.length; e++) {
            var f = tinycolor(a[e]), u = 0.5 > f.toHsl().l ? "sp-thumb-el sp-thumb-dark" : "sp-thumb-el sp-thumb-light", u = u + (tinycolor.equals(b, a[e]) ? " sp-thumb-active" : ""), h = c ? "background-color:" + f.toRgbString() : "filter:" + f.toFilter();
            g.push('<span title="' + f.toHexString() + '" data-color="' + f.toRgbString() + '" class="' + u + '"><span class="sp-thumb-inner" style="' + h + ';" /></span>')
        }
        return "<div class='sp-cf " + d + "'>" + g.join("") + "</div>"
    }
    function I(a, b) {
        var c = a.outerWidth(), d = a.outerHeight(), e = b.outerHeight(), f = a[0].ownerDocument, u = f.documentElement, h = u.clientWidth + g(f).scrollLeft(), f = u.clientHeight + g(f).scrollTop(), u = b.offset();
        u.top += e;
        u.left -= Math.min(u.left, u.left + c > h && h > c ? Math.abs(u.left + c - h) : 0);
        u.top -= Math.min(u.top, u.top + d > f && f > d ? Math.abs(d + e - 0) : 0);
        return u
    }
    function m() {
    }
    function p(a) {
        a.stopPropagation()
    }
    function w(a, b) {
        var c = Array.prototype.slice, d = c.call(arguments, 2);
        return function() {
            return a.apply(b, d.concat(c.call(arguments)))
        }
    }
    function D(a, b, c, d) {
        function j(a) {
            a.stopPropagation && a.stopPropagation();
            a.preventDefault && a.preventDefault();
            a.returnValue = !1
        }
        function f(c) {
            if (m) {
                if (e && 9 > document.documentMode && !c.button)
                    return u();
                var f = c.originalEvent.touches, d = f ? f[0].pageY : c.pageY, f = Math.max(0, Math.min((f ? f[0].pageX : c.pageX) - q.left, s)), d = Math.max(0, Math.min(d - q.top, p));
                w && j(c);
                b.apply(a, [f, d, c])
            }
        }
        function u() {
            m && (g(n).unbind(A), g(n.body).removeClass("sp-dragging"), d.apply(a, arguments));
            m = !1
        }
        b = b || function() {
        };
        c = c || function() {
        };
        d = d || function() {
        };
        var n = a.ownerDocument || document, m = !1, q = {}, p = 0, s = 0, w = "ontouchstart" in h, A = {};
        A.selectstart = j;
        A.dragstart = j;
        A[w ? "touchmove" : "mousemove"] = f;
        A[w ? "touchend" : "mouseup"] = u;
        g(a).bind(w ? "touchstart" : "mousedown", function(b) {
            if (!(b.which ? 3 == b.which : 2 == b.button) && !m && !1 !== c.apply(a, arguments))
                m = !0, p = g(a).height(), s = g(a).width(), q = g(a).offset(), g(n).bind(A), g(n.body).addClass("sp-dragging"), w || f(b), j(b)
        })
    }
    var T = {beforeShow: m,move: m,change: m,show: m,hide: m,color: !1,flat: !1,showInput: !1,showButtons: !0,clickoutFiresChange: !1,showInitial: !1,showPalette: !1,showPaletteOnly: !1,showSelectionPalette: !0,localStorageKey: !1,maxSelectionSize: 7,cancelText: "cancel",chooseText: "choose",preferredFormat: !1,className: "",showAlpha: !1,theme: "sp-light",palette: ["fff", "000"],selectionPalette: []}, B = [], e = !!/msie/i.exec(h.navigator.userAgent), c, b = document.createElement("div").style;
    b.cssText = "background-color:rgba(0,0,0,.5)";
    c = !!~("" + b.backgroundColor).indexOf("rgba") || !!~("" + b.backgroundColor).indexOf("hsla");
    var j, b = "";
    if (e)
        for (var a = 1; 6 >= a; a++)
            b += "<div class='sp-" + a + "'></div>";
    j = ["<div class='sp-container'><div class='sp-palette-container'><div class='sp-palette sp-thumb sp-cf'></div></div><div class='sp-picker-container'><div class='sp-top sp-cf'><div class='sp-fill'></div><div class='sp-top-inner'><div class='sp-color'><div class='sp-sat'><div class='sp-val'><div class='sp-dragger'></div></div></div></div><div class='sp-hue'><div class='sp-slider'></div>", b, "</div></div><div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div></div><div class='sp-input-container sp-cf'><input class='sp-input' type='text' spellcheck='false' /></div><div class='sp-initial sp-thumb sp-cf'></div><div class='sp-button-container sp-cf'><a class='sp-cancel' href='#'></a><button class='sp-choose'></button></div></div></div>"].join("");
    g.fn.spectrum = function(a, b) {
        return "string" == typeof a ? "get" == a ? B[this.eq(0).data("spectrum.id")].get() : "container" == a ? B[g(this).data("spectrum.id")].container : this.each(function() {
            var c = B[g(this).data("spectrum.id")];
            c && ("show" == a && c.show(), "hide" == a && c.hide(), "toggle" == a && c.toggle(), "reflow" == a && c.reflow(), "set" == a && c.set(b), "destroy" == a && (c.destroy(), g(this).removeData("spectrum.id")))
        }) : this.spectrum("destroy").each(function() {
            var b, d = function(a) {
                S && (la.push(tinycolor(a).toHexString()), R && h.localStorage && (h.localStorage[R] = la.join(",")))
            }, t = function() {
                var a = [], b = la, c = {}, f;
                if (J) {
                    for (var d = 0; d < ea.length; d++)
                        for (var t = 0; t < ea[d].length; t++)
                            f = tinycolor(ea[d][t]).toHexString(), c[f] = !0;
                    for (d = 0; d < b.length; d++)
                        f = tinycolor(b[d]).toHexString(), c.hasOwnProperty(f) || (a.push(b[d]), c[f] = !0)
                }
                return a.reverse().slice(0, F.maxSelectionSize)
            }, f = function() {
                var a = A(), b = g.map(ea, function(b, c) {
                    return L(b, a, "sp-palette-row sp-palette-row-" + c)
                });
                la && b.push(L(t(), a, "sp-palette-row sp-palette-row-selection"));
                Na.html(b.join(""))
            }, u = function() {
                if (M) {
                    var a = ra, b = A();
                    Oa.html(L([a, b], b, "sp-palette-row-initial"))
                }
            };
            b = function() {
                (0 === oa || 0 === ua || 0 === ya) && r();
                O.addClass(ga)
            };
            var n = function() {
                O.removeClass(ga)
            }, m = function() {
                var a = tinycolor(na.val());
                a.ok ? N(a) : na.addClass("sp-validation-error")
            }, q = function() {
                fa ? y() : s()
            }, s = function() {
                if (fa)
                    r();
                else if (!1 !== V.beforeShow(A())) {
                    for (var a = 0; a < B.length; a++)
                        B[a] && B[a].hide();
                    fa = !0;
                    g(qa).bind("click.spectrum", y);
                    g(h).bind("resize.spectrum", Z);
                    sa.addClass("sp-active");
                    O.show();
                    J && f();
                    r();
                    E();
                    ra = A();
                    u();
                    V.show(ra)
                }
            }, y = function(a) {
                if ((!a || !("click" == a.type && 2 == a.button)) && fa && !G)
                    fa = !1, g(qa).unbind("click.spectrum", y), g(h).unbind("resize.spectrum", Z), sa.removeClass("sp-active"), O.hide(), tinycolor.equals(A(), ra) || (Va && "cancel" !== a ? l(!0) : N(ra, !0)), V.hide(A())
            }, N = function(a, b) {
                if (!tinycolor.equals(a, A())) {
                    var c = tinycolor(a), f = c.toHsv();
                    va = f.h;
                    za = f.s;
                    Aa = f.v;
                    ma = f.a;
                    E();
                    b || (Ba = Fa || c.format)
                }
            }, A = function() {
                return tinycolor.fromRatio({h: va,s: za,v: Aa,a: Math.round(100 * ma) / 100})
            }, X = function() {
                E();
                V.move(A())
            }, E = function() {
                na.removeClass("sp-validation-error");
                H();
                var a = tinycolor({h: va,s: "1.0",v: "1.0"});
                xa.css("background-color", a.toHexString());
                a = Ba;
                if (1 > ma && ("hex" === a || "name" === a))
                    a = "rgb";
                var b = A(), d = b.toHexString(), t = b.toRgbString();
                c || 1 === b.alpha ? Ga.css("background-color", t) : (Ga.css("background-color", "transparent"), Ga.css("filter", b.toFilter()));
                if (Q) {
                    t = b.toRgb();
                    t.a = 0;
                    var t = tinycolor(t).toRgbString(), v = "linear-gradient(left, " + t + ", " + d + ")";
                    e ? wa.css("filter", tinycolor(t).toFilter({gradientType: 1}, d)) : (wa.css("background", "-webkit-" + v), wa.css("background", "-moz-" + v), wa.css("background", "-ms-" + v), wa.css("background", v))
                }
                if (P) {
                    if (1 > ma && ("hex" === a || "name" === a))
                        a = "rgb";
                    na.val(b.toString(a))
                }
                J && f();
                u()
            }, H = function() {
                var a = za * ua, b = oa - Aa * oa, a = Math.max(-pa, Math.min(ua - pa, a - pa)), b = Math.max(-pa, Math.min(oa - pa, b - pa));
                Pa.css({top: b,left: a});
                Qa.css({left: ma * Ea - La / 2});
                Ra.css({top: va * ya - Ma})
            }, l = function(a) {
                var b = A();
                Ha && aa.val(b.toString(Ba)).change();
                var c = !tinycolor.equals(b, ra);
                ra = b;
                d(b);
                a && c && V.change(b)
            }, r = function() {
                ua = xa.width();
                oa = xa.height();
                pa = Pa.height();
                Ia.width();
                ya = Ia.height();
                Ma = Ra.height();
                Ea = Sa.width();
                La = Qa.width();
                G || O.offset(I(O, Ja));
                H()
            }, F, C = g.extend({}, T, a);
            C.callbacks = {move: w(C.move, this),change: w(C.change, this),show: w(C.show, this),hide: w(C.hide, this),beforeShow: w(C.beforeShow, this)};
            F = C;
            var G = F.flat, C = F.showPaletteOnly, J = F.showPalette || C, M = F.showInitial && !G, P = F.showInput, Q = F.showAlpha, S = F.showSelectionPalette, R = F.localStorageKey, U = F.theme, V = F.callbacks, Z, da = r, z;
            Z = function() {
                var a = this, b = arguments;
                z || (z = setTimeout(function() {
                    z = null;
                    da.apply(a, b)
                }, 10))
            };
            var fa = !1, ua = 0, oa = 0, pa = 0, ya = 0, Ea = 0, La = 0, Ma = 0, va = 0, za = 0, Aa = 0, ma = 1, K = F.palette.slice(0), ea = g.isArray(K[0]) ? K : [K], la = F.selectionPalette.slice(0), ga = "sp-dragging", qa = this.ownerDocument, K = qa.body, aa = g(this), O = g(j, qa).addClass(U), xa = O.find(".sp-color"), Pa = O.find(".sp-dragger"), Ia = O.find(".sp-hue"), Ra = O.find(".sp-slider"), wa = O.find(".sp-alpha-inner"), Sa = O.find(".sp-alpha"), Qa = O.find(".sp-alpha-handle"), na = O.find(".sp-input"), Na = O.find(".sp-palette"), Oa = O.find(".sp-initial"), Ta = O.find(".sp-cancel"), Ua = O.find(".sp-choose"), Ha = aa.is("input"), Ka = Ha && !G, sa = Ka ? g("<div class='sp-replacer'><div class='sp-preview'><div class='sp-preview-inner'></div></div><div class='sp-dd'>&#9660;</div></div>").addClass(U) : g([]), Ja = Ka ? sa : aa, Ga = sa.find(".sp-preview-inner"), Ca = F.color || Ha && aa.val(), ra = !1, Fa = F.preferredFormat, Ba = Fa, Va = !F.showButtons || F.clickoutFiresChange;
            Ua.text(F.chooseText);
            Ta.text(F.cancelText);
            U = function(a) {
                a.data && a.data.ignore ? (N(g(this).data("color")), X()) : (N(g(this).data("color")), l(!0), X(), y());
                return !1
            };
            e && O.find("*:not(input)").attr("unselectable", "on");
            O.toggleClass("sp-flat", G);
            O.toggleClass("sp-input-disabled", !P);
            O.toggleClass("sp-alpha-enabled", Q);
            O.toggleClass("sp-buttons-disabled", !F.showButtons || G);
            O.toggleClass("sp-palette-disabled", !J);
            O.toggleClass("sp-palette-only", C);
            O.toggleClass("sp-initial-disabled", !M);
            O.addClass(F.className);
            Ka && aa.hide().after(sa);
            G ? aa.after(O).hide() : g(K).append(O.hide());
            if (R && h.localStorage)
                try {
                    la = h.localStorage[R].split(",")
                } catch (Wa) {
                }
            Ja.bind("click.spectrum touchstart.spectrum", function(a) {
                q();
                a.stopPropagation();
                g(a.target).is("input") || a.preventDefault()
            });
            O.click(p);
            na.change(m);
            na.bind("paste", function() {
                setTimeout(m, 1)
            });
            na.keydown(function(a) {
                13 == a.keyCode && m()
            });
            Ta.bind("click.spectrum", function(a) {
                a.stopPropagation();
                a.preventDefault();
                y("cancel")
            });
            Ua.bind("click.spectrum", function(a) {
                a.stopPropagation();
                a.preventDefault();
                na.hasClass("sp-validation-error") || (l(!0), y())
            });
            D(Sa, function(a, b, c) {
                ma = a / Ea;
                c.shiftKey && (ma = Math.round(10 * ma) / 10);
                X()
            });
            D(Ia, function(a, b) {
                va = b / ya;
                X()
            }, b, n);
            D(xa, function(a, b) {
                za = a / ua;
                Aa = (oa - b) / oa;
                X()
            }, b, n);
            Ca ? (N(Ca), E(), Ba = Fa || tinycolor(Ca).format, d(Ca)) : E();
            G && s();
            b = e ? "mousedown.spectrum" : "click.spectrum touchstart.spectrum";
            Na.delegate(".sp-thumb-el", b, U);
            Oa.delegate(".sp-thumb-el::nth-child(1)", b, {ignore: !0}, U);
            var Da = {show: s,hide: y,toggle: q,reflow: r,set: function(a) {
                    N(a);
                    l()
                },get: A,destroy: function() {
                    aa.show();
                    Ja.unbind("click.spectrum touchstart.spectrum");
                    O.remove();
                    sa.remove();
                    B[Da.id] = null
                },container: O};
            Da.id = B.push(Da) - 1;
            b = Da;
            g(this).data("spectrum.id", b.id)
        })
    };
    g.fn.spectrum.load = !0;
    g.fn.spectrum.loadOpts = {};
    g.fn.spectrum.draggable = D;
    g.fn.spectrum.defaults = T;
    g.fn.spectrum.processNativeColorInputs = function() {
        var a = g("<input type='color' value='!' />")[0];
        "color" === a.type && "!" != a.value || g("input[type=color]").spectrum({preferredFormat: "hex6"})
    };
    var d = function(a) {
        var b, c, e, g, f;
        if ("object" == typeof a && a.hasOwnProperty("_tc_id"))
            return a;
        c = a;
        var u = 0, h = 0, j = 0;
        a = 1;
        var m = !1, p = !1;
        if ("string" == typeof c)
            a: {
                c = c.replace(da, "").replace(y, "").toLowerCase();
                var s = !1;
                if (R[c])
                    c = R[c], s = !0;
                else if ("transparent" == c) {
                    c = {r: 0,g: 0,b: 0,a: 0};
                    break a
                }
                c = (b = V.rgb.exec(c)) ? {r: b[1],g: b[2],b: b[3]} : (b = V.rgba.exec(c)) ? {r: b[1],g: b[2],b: b[3],a: b[4]} : (b = V.hsl.exec(c)) ? {h: b[1],s: b[2],l: b[3]} : (b = V.hsla.exec(c)) ? {h: b[1],s: b[2],l: b[3],a: b[4]} : (b = V.hsv.exec(c)) ? {h: b[1],s: b[2],v: b[3]} : (b = V.hex6.exec(c)) ? {r: parseInt(b[1], 16),g: parseInt(b[2], 16),b: parseInt(b[3], 16),format: s ? "name" : "hex"} : (b = V.hex3.exec(c)) ? {r: parseInt(b[1] + "" + b[1], 16),g: parseInt(b[2] + "" + b[2], 16),b: parseInt(b[3] + "" + b[3], 16),format: s ? "name" : "hex"} : !1
            }
        "object" == typeof c && (c.hasOwnProperty("r") && c.hasOwnProperty("g") && c.hasOwnProperty("b") ? (u = 255 * E(c.r, 255), h = 255 * E(c.g, 255), j = 255 * E(c.b, 255), m = !0, p = "rgb") : c.hasOwnProperty("h") && c.hasOwnProperty("s") && c.hasOwnProperty("v") ? (p = c.h, h = c.s, j = c.v, p = 6 * E(p, 360), h = E(h, 100), j = E(j, 100), u = M.floor(p), m = p - u, p = j * (1 - h), b = j * (1 - m * h), m = j * (1 - (1 - m) * h), s = u % 6, u = 255 * [j, b, p, p, m, j][s], h = 255 * [m, j, j, b, p, p][s], j = 255 * [p, p, m, j, j, b][s], m = !0, p = "hsv") : c.hasOwnProperty("h") && (c.hasOwnProperty("s") && c.hasOwnProperty("l")) && (u = c.h, p = c.s, j = c.l, h = function(a, b, c) {
            0 > c && (c += 1);
            1 < c && (c -= 1);
            return c < 1 / 6 ? a + 6 * (b - a) * c : 0.5 > c ? b : c < 2 / 3 ? a + 6 * (b - a) * (2 / 3 - c) : a
        }, u = E(u, 360), p = E(p, 100), j = E(j, 100), 0 === p ? p = j = b = j : (b = 0.5 > j ? j * (1 + p) : j + p - j * p, m = 2 * j - b, p = h(m, b, u + 1 / 3), j = h(m, b, u), b = h(m, b, u - 1 / 3)), u = 255 * p, h = 255 * j, j = 255 * b, m = !0, p = "hsl"), c.hasOwnProperty("a") && (a = c.a));
        u = G(255, n(u, 0));
        h = G(255, n(h, 0));
        j = G(255, n(j, 0));
        1 > u && (u = C(u));
        1 > h && (h = C(h));
        1 > j && (j = C(j));
        b = m;
        c = c && c.format || p;
        e = u;
        g = h;
        f = j;
        var w = H(a);
        return {ok: b,format: c,_tc_id: fa++,alpha: w,toHsv: function() {
                var a = J(e, g, f);
                return {h: a.h,s: a.s,v: a.v,a: w}
            },toHsvString: function() {
                var a = J(e, g, f), b = C(360 * a.h), c = C(100 * a.s), a = C(100 * a.v);
                return 1 == w ? "hsv(" + b + ", " + c + "%, " + a + "%)" : "hsva(" + b + ", " + c + "%, " + a + "%, " + w + ")"
            },toHsl: function() {
                var a = U(e, g, f);
                return {h: a.h,s: a.s,l: a.l,a: w}
            },toHslString: function() {
                var a = U(e, g, f), b = C(360 * a.h), c = C(100 * a.s), a = C(100 * a.l);
                return 1 == w ? "hsl(" + b + ", " + c + "%, " + a + "%)" : "hsla(" + b + ", " + c + "%, " + a + "%, " + w + ")"
            },toHex: function() {
                return q(e, g, f)
            },toHexString: function(a) {
                return "#" + q(e, g, f, a)
            },toRgb: function() {
                return {r: C(e),g: C(g),b: C(f),a: w}
            },toRgbString: function() {
                return 1 == w ? "rgb(" + C(e) + ", " + C(g) + ", " + C(f) + ")" : "rgba(" + C(e) + ", " + C(g) + ", " + C(f) + ", " + w + ")"
            },toName: function() {
                return Q[q(e, g, f)] || !1
            },toFilter: function(a, b) {
                var c = q(e, g, f, !0), u = c, h = Math.round(255 * H(w)).toString(16), j = h, t = a && a.gradientType ? "GradientType = 1, " : "";
                b && (j = d(b), u = j.toHex(), j = Math.round(255 * H(j.alpha)).toString(16));
                return "progid:DXImageTransform.Microsoft.gradient(" + t + "startColorstr=#" + P(h) + c + ",endColorstr=#" + P(j) + u + ")"
            },toString: function(a) {
                a = a || this.format;
                var b = !1;
                "rgb" === a && (b = this.toRgbString());
                "hex" === a && (b = this.toHexString());
                "hex6" === a && (b = this.toHexString(!0));
                "name" === a && (b = this.toName());
                "hsl" === a && (b = this.toHslString());
                "hsv" === a && (b = this.toHsvString());
                return b || this.toHexString(!0)
            }}
    }, U = function(a, b, c) {
        a = E(a, 255);
        b = E(b, 255);
        c = E(c, 255);
        var d = n(a, b, c), e = G(a, b, c), f, g = (d + e) / 2;
        if (d == e)
            f = e = 0;
        else {
            var h = d - e, e = 0.5 < g ? h / (2 - d - e) : h / (d + e);
            switch (d) {
                case a:
                    f = (b - c) / h + (b < c ? 6 : 0);
                    break;
                case b:
                    f = (c - a) / h + 2;
                    break;
                case c:
                    f = (a - b) / h + 4
            }
            f /= 6
        }
        return {h: f,s: e,l: g}
    }, J = function(a, b, c) {
        a = E(a, 255);
        b = E(b, 255);
        c = E(c, 255);
        var d = n(a, b, c), e = G(a, b, c), f, g = d - e;
        if (d == e)
            f = 0;
        else {
            switch (d) {
                case a:
                    f = (b - c) / g + (b < c ? 6 : 0);
                    break;
                case b:
                    f = (c - a) / g + 2;
                    break;
                case c:
                    f = (a - b) / g + 4
            }
            f /= 6
        }
        return {h: f,s: 0 === d ? 0 : g / d,v: d}
    }, q = function(a, b, c, d) {
        a = [P(C(a).toString(16)), P(C(b).toString(16)), P(C(c).toString(16))];
        return !d && a[0].charAt(0) == a[0].charAt(1) && a[1].charAt(0) == a[1].charAt(1) && a[2].charAt(0) == a[2].charAt(1) ? a[0].charAt(0) + a[1].charAt(0) + a[2].charAt(0) : a.join("")
    }, E = function(a, b) {
        "string" == typeof a && (-1 != a.indexOf(".") && 1 === H(a)) && (a = "100%");
        var c = "string" === typeof a && -1 != a.indexOf("%");
        a = G(b, n(0, H(a)));
        c && (a *= b / 100);
        return 1E-6 > M.abs(a - b) ? 1 : 1 <= a ? a % b / H(b) : a
    }, P = function(a) {
        return 1 == a.length ? "0" + a : "" + a
    }, da = /^[\s,#]+/, y = /\s+$/, fa = 0, M = Math, C = M.round, G = M.min, n = M.max, s = M.random, H = this.parseFloat;
    d.fromRatio = function(a) {
        if ("object" == typeof a)
            for (var b in a)
                1 === a[b] && (a[b] = "1.0");
        return d(a)
    };
    d.equals = function(a, b) {
        return !a || !b ? !1 : d(a).toRgbString() == d(b).toRgbString()
    };
    d.random = function() {
        return d.fromRatio({r: s(),g: s(),b: s()})
    };
    d.desaturate = function(a, b) {
        var c = d(a).toHsl();
        c.s -= (b || 10) / 100;
        c.s = G(1, n(0, c.s));
        return d(c)
    };
    d.saturate = function(a, b) {
        var c = d(a).toHsl();
        c.s += (b || 10) / 100;
        c.s = G(1, n(0, c.s));
        return d(c)
    };
    d.greyscale = function(a) {
        return d.desaturate(a, 100)
    };
    d.lighten = function(a, b) {
        var c = d(a).toHsl();
        c.l += (b || 10) / 100;
        c.l = G(1, n(0, c.l));
        return d(c)
    };
    d.darken = function(a, b) {
        var c = d(a).toHsl();
        c.l -= (b || 10) / 100;
        c.l = G(1, n(0, c.l));
        return d(c)
    };
    d.complement = function(a) {
        a = d(a).toHsl();
        a.h = (a.h + 0.5) % 1;
        return d(a)
    };
    d.triad = function(a) {
        var b = d(a).toHsl(), c = 360 * b.h;
        return [d(a), d({h: (c + 120) % 360,s: b.s,l: b.l}), d({h: (c + 240) % 360,s: b.s,l: b.l})]
    };
    d.tetrad = function(a) {
        var b = d(a).toHsl(), c = 360 * b.h;
        return [d(a), d({h: (c + 90) % 360,s: b.s,l: b.l}), d({h: (c + 180) % 360,s: b.s,l: b.l}), d({h: (c + 270) % 360,s: b.s,l: b.l})]
    };
    d.splitcomplement = function(a) {
        var b = d(a).toHsl(), c = 360 * b.h;
        return [d(a), d({h: (c + 72) % 360,s: b.s,l: b.l}), d({h: (c + 216) % 360,s: b.s,l: b.l})]
    };
    d.analogous = function(a, b, c) {
        b = b || 6;
        c = c || 30;
        var e = d(a).toHsl();
        c = 360 / c;
        a = [d(a)];
        e.h *= 360;
        for (e.h = (e.h - (c * b >> 1) + 720) % 360; --b; )
            e.h = (e.h + c) % 360, a.push(d(e));
        return a
    };
    d.monochromatic = function(a, b) {
        b = b || 6;
        for (var c = d(a).toHsv(), e = c.h, g = c.s, c = c.v, f = [], h = 1 / b; b--; )
            f.push(d({h: e,s: g,v: c})), c = (c + h) % 1;
        return f
    };
    d.readable = function(a, b) {
        var c = d(a).toRgb(), e = d(b).toRgb();
        return 10404 < (e.r - c.r) * (e.r - c.r) + (e.g - c.g) * (e.g - c.g) + (e.b - c.b) * (e.b - c.b)
    };
    var R = d.names = {aliceblue: "f0f8ff",antiquewhite: "faebd7",aqua: "0ff",aquamarine: "7fffd4",azure: "f0ffff",beige: "f5f5dc",bisque: "ffe4c4",black: "000",blanchedalmond: "ffebcd",blue: "00f",blueviolet: "8a2be2",brown: "a52a2a",burlywood: "deb887",burntsienna: "ea7e5d",cadetblue: "5f9ea0",chartreuse: "7fff00",chocolate: "d2691e",coral: "ff7f50",cornflowerblue: "6495ed",cornsilk: "fff8dc",crimson: "dc143c",cyan: "0ff",darkblue: "00008b",darkcyan: "008b8b",darkgoldenrod: "b8860b",darkgray: "a9a9a9",darkgreen: "006400",darkgrey: "a9a9a9",darkkhaki: "bdb76b",darkmagenta: "8b008b",darkolivegreen: "556b2f",darkorange: "ff8c00",darkorchid: "9932cc",darkred: "8b0000",darksalmon: "e9967a",darkseagreen: "8fbc8f",darkslateblue: "483d8b",darkslategray: "2f4f4f",darkslategrey: "2f4f4f",darkturquoise: "00ced1",darkviolet: "9400d3",deeppink: "ff1493",deepskyblue: "00bfff",dimgray: "696969",dimgrey: "696969",dodgerblue: "1e90ff",firebrick: "b22222",floralwhite: "fffaf0",forestgreen: "228b22",fuchsia: "f0f",gainsboro: "dcdcdc",ghostwhite: "f8f8ff",gold: "ffd700",goldenrod: "daa520",gray: "808080",green: "008000",greenyellow: "adff2f",grey: "808080",honeydew: "f0fff0",hotpink: "ff69b4",indianred: "cd5c5c",indigo: "4b0082",ivory: "fffff0",khaki: "f0e68c",lavender: "e6e6fa",lavenderblush: "fff0f5",lawngreen: "7cfc00",lemonchiffon: "fffacd",lightblue: "add8e6",lightcoral: "f08080",lightcyan: "e0ffff",lightgoldenrodyellow: "fafad2",lightgray: "d3d3d3",lightgreen: "90ee90",lightgrey: "d3d3d3",lightpink: "ffb6c1",lightsalmon: "ffa07a",lightseagreen: "20b2aa",lightskyblue: "87cefa",lightslategray: "789",lightslategrey: "789",lightsteelblue: "b0c4de",lightyellow: "ffffe0",lime: "0f0",limegreen: "32cd32",linen: "faf0e6",magenta: "f0f",maroon: "800000",mediumaquamarine: "66cdaa",mediumblue: "0000cd",mediumorchid: "ba55d3",mediumpurple: "9370db",mediumseagreen: "3cb371",mediumslateblue: "7b68ee",mediumspringgreen: "00fa9a",mediumturquoise: "48d1cc",mediumvioletred: "c71585",midnightblue: "191970",mintcream: "f5fffa",mistyrose: "ffe4e1",moccasin: "ffe4b5",navajowhite: "ffdead",navy: "000080",oldlace: "fdf5e6",olive: "808000",olivedrab: "6b8e23",orange: "ffa500",orangered: "ff4500",orchid: "da70d6",palegoldenrod: "eee8aa",palegreen: "98fb98",paleturquoise: "afeeee",palevioletred: "db7093",papayawhip: "ffefd5",peachpuff: "ffdab9",peru: "cd853f",pink: "ffc0cb",plum: "dda0dd",powderblue: "b0e0e6",purple: "800080",red: "f00",rosybrown: "bc8f8f",royalblue: "4169e1",saddlebrown: "8b4513",salmon: "fa8072",sandybrown: "f4a460",seagreen: "2e8b57",seashell: "fff5ee",sienna: "a0522d",silver: "c0c0c0",skyblue: "87ceeb",slateblue: "6a5acd",slategray: "708090",slategrey: "708090",snow: "fffafa",springgreen: "00ff7f",steelblue: "4682b4",tan: "d2b48c",teal: "008080",thistle: "d8bfd8",tomato: "ff6347",turquoise: "40e0d0",violet: "ee82ee",wheat: "f5deb3",white: "fff",whitesmoke: "f5f5f5",yellow: "ff0",yellowgreen: "9acd32"}, b = d, a = R, S = {}, Z;
    for (Z in a)
        a.hasOwnProperty(Z) && (S[a[Z]] = Z);
    var Q = b.hexNames = S, V;
    V = {rgb: RegExp("rgb[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),rgba: RegExp("rgba[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hsl: RegExp("hsl[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hsla: RegExp("hsla[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hsv: RegExp("hsv[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hex3: /^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6: /^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};
    this.tinycolor = d;
    g(function() {
        g.fn.spectrum.load && g.fn.spectrum.processNativeColorInputs()
    })
})(window, jQuery);
function Hammer(h, g, L) {
    var I, m;
    function p(a) {
        return a.touches ? a.touches.length : 1
    }
    function w(a) {
        a = a || window.event;
        if (v) {
            for (var b = [], c, d = 0, e = a.touches.length; d < e; d++)
                c = a.touches[d], b.push({x: c.pageX,y: c.pageY});
            return b
        }
        b = document;
        c = b.body;
        return [{x: a.pageX || a.clientX + (b && b.scrollLeft || c && c.scrollLeft || 0) - (b && b.clientLeft || c && b.clientLeft || 0),y: a.pageY || a.clientY + (b && b.scrollTop || c && c.scrollTop || 0) - (b && b.clientTop || c && b.clientTop || 0)}]
    }
    function D(a, b) {
        return 180 * Math.atan2(b.y - a.y, b.x - a.x) / Math.PI
    }
    function T(a, b) {
        var c = b.x - a.x, d = b.y - a.y;
        return Math.sqrt(c * c + d * d)
    }
    function B(a, b) {
        if (2 == a.length && 2 == b.length) {
            var c = T(a[0], a[1]);
            return T(b[0], b[1]) / c
        }
        return 0
    }
    function e(a, b) {
        if (2 == a.length && 2 == b.length) {
            var c = D(a[1], a[0]);
            return D(b[1], b[0]) - c
        }
        return 0
    }
    function c(a, b) {
        b.touches = w(b.originalEvent);
        b.type = a;
        "[object Function]" == Object.prototype.toString.call(q["on" + a]) && q["on" + a].call(q, b)
    }
    function b(a) {
        a = a || window.event;
        a.preventDefault ? (a.preventDefault(), a.stopPropagation()) : (a.returnValue = !1, a.cancelBubble = !0)
    }
    function j() {
        n = {};
        s = !1;
        C = M = 0;
        H = null
    }
    function a(a) {
        function d() {
            n.start = w(a);
            S = (new Date).getTime();
            p(a);
            s = !0;
            t = a;
            var b = h.getBoundingClientRect();
            I = b.top + (window.pageYOffset || h.scrollTop || document.body.scrollTop) - (h.clientTop || document.body.clientTop || 0);
            m = b.left + (window.pageXOffset || h.scrollLeft || document.body.scrollLeft) - (h.clientLeft || document.body.clientLeft || 0);
            x = !0;
            W.hold(a)
        }
        switch (a.type) {
            case "mousedown":
            case "touchstart":
                var q = p(a);
                ka = 1 === q;
                2 === q && "drag" === H && c("dragend", {originalEvent: a,direction: G,distance: M,angle: C});
                d();
                g.prevent_default && b(a);
                break;
            case "mousemove":
            case "touchmove":
                q = p(a);
                if (!x && 1 === q)
                    return !1;
                !x && 2 === q && (ka = !1, j(), d());
                n.move = w(a);
                W.transform(a) || W.drag(a);
                break;
            case "mouseup":
            case "mouseout":
            case "touchcancel":
            case "touchend":
                q = !0, x = !1, W.swipe(a), "drag" == H ? c("dragend", {originalEvent: a,direction: G,distance: M,angle: C}) : "transform" == H ? (c("transformend", {originalEvent: a,position: n.center,scale: B(n.start, n.move),rotation: e(n.start, n.move),distance: M,distanceX: _distance_x,distanceY: _distance_y}), 1 === p(a) && (j(), d(), q = !1)) : ka && W.tap(t), R = H, c("release", {originalEvent: a,gesture: H,position: n.move || n.start}), q && j()
        }
    }
    function d(b) {
        var c;
        a: if (c = b.relatedTarget, !c && (window.event && window.event.toElement) && (c = window.event.toElement), h === c)
            c = !0;
        else {
            if (c)
                for (c = c.parentNode; null !== c; ) {
                    if (c === h) {
                        c = !0;
                        break a
                    }
                    c = c.parentNode
                }
            c = !1
        }
        c || a(b)
    }
    function U(a, b, c) {
        b = b.split(" ");
        for (var d = 0, e = b.length; d < e; d++)
            a.addEventListener ? a.addEventListener(b[d], c, !1) : document.attachEvent && a.attachEvent("on" + b[d], c)
    }
    function J(a, b, c) {
        b = b.split(" ");
        for (var d = 0, e = b.length; d < e; d++)
            a.removeEventListener ? a.removeEventListener(b[d], c, !1) : document.detachEvent && a.detachEvent("on" + b[d], c)
    }
    var q = this;
    var E = {prevent_default: !1,css_hacks: !0,swipe: !0,swipe_time: 200,swipe_min_distance: 20,drag: !0,drag_vertical: !0,drag_horizontal: !0,drag_min_distance: 20,transform: !0,scale_treshold: 0.1,rotation_treshold: 15,tap: !0,tap_double: !0,tap_max_interval: 300,tap_max_distance: 10,tap_double_distance: 20,hold: !0,hold_timeout: 500}, P = g, da = {};
    if (P) {
        for (var y in E)
            da[y] = y in P ? P[y] : E[y];
        g = da
    } else
        g = E;
    if (g.css_hacks) {
        E = ["webkit", "moz", "ms", "o", ""];
        P = {userSelect: "none",touchCallout: "none",userDrag: "none",tapHighlightColor: "rgba(0,0,0,0)"};
        da = "";
        for (y = 0; y < E.length; y++)
            for (var fa in P)
                da = fa, E[y] && (da = E[y] + da.substring(0, 1).toUpperCase() + da.substring(1)), h.style[da] = P[fa]
    }
    var M = 0, C = 0, G = 0, n = {}, s = !1, H = null, R = null, S = null, Z = {x: 0,y: 0}, Q = null, V = null;
    m = I = void 0;
    var x = !1, t, v = "ontouchstart" in window, ka = !1;
    this.option = function(a, b) {
        b != L && (g[a] = b);
        return g[a]
    };
    this.getDirectionFromAngle = function(a) {
        a = {down: 45 <= a && 135 > a,left: 135 <= a || -135 >= a,up: -45 > a && -135 < a,right: -45 <= a && 45 >= a};
        var b, c;
        for (c in a)
            if (a[c]) {
                b = c;
                break
            }
        return b
    };
    this.destroy = function() {
        v ? J(h, "touchstart touchmove touchend touchcancel", a) : (J(h, "mouseup mousedown mousemove", a), J(h, "mouseout", d))
    };
    var W = {hold: function(a) {
            g.hold && (H = "hold", clearTimeout(V), V = setTimeout(function() {
                "hold" == H && c("hold", {originalEvent: a,position: n.start})
            }, g.hold_timeout))
        },swipe: function(a) {
            if (n.move && "transform" !== H) {
                var b = n.move[0].x - n.start[0].x, d = n.move[0].y - n.start[0].y;
                M = Math.sqrt(b * b + d * d);
                var e = (new Date).getTime() - S;
                g.swipe && (g.swipe_time > e && M > g.swipe_min_distance) && (C = D(n.start[0], n.move[0]), G = q.getDirectionFromAngle(C), H = "swipe", c("swipe", {originalEvent: a,position: {x: n.move[0].x - m,y: n.move[0].y - I},direction: G,distance: M,distanceX: b,distanceY: d,angle: C}))
            }
        },drag: function(a) {
            var d = n.move[0].x - n.start[0].x, e = n.move[0].y - n.start[0].y;
            M = Math.sqrt(d * d + e * e);
            if (g.drag && M > g.drag_min_distance || "drag" == H) {
                C = D(n.start[0], n.move[0]);
                G = q.getDirectionFromAngle(C);
                var h = "up" == G || "down" == G;
                (h && !g.drag_vertical || !h && !g.drag_horizontal) && M > g.drag_min_distance || (H = "drag", d = {originalEvent: a,position: {x: n.move[0].x - m,y: n.move[0].y - I},direction: G,distance: M,distanceX: d,distanceY: e,angle: C}, s && (c("dragstart", d), s = !1), c("drag", d), b(a))
            }
        },transform: function(a) {
            if (g.transform) {
                if (2 !== p(a))
                    return !1;
                var d = e(n.start, n.move), h = B(n.start, n.move);
                if ("transform" === H || Math.abs(1 - h) > g.scale_treshold || Math.abs(d) > g.rotation_treshold) {
                    H = "transform";
                    n.center = {x: (n.move[0].x + n.move[1].x) / 2 - m,y: (n.move[0].y + n.move[1].y) / 2 - I};
                    s && (n.startCenter = n.center);
                    var j = n.center.x - n.startCenter.x, q = n.center.y - n.startCenter.y;
                    M = Math.sqrt(j * j + q * q);
                    d = {originalEvent: a,position: n.center,scale: h,rotation: d,distance: M,distanceX: j,distanceY: q};
                    s && (c("transformstart", d), s = !1);
                    c("transform", d);
                    b(a);
                    return !0
                }
            }
            return !1
        },tap: function(a) {
            var d = (new Date).getTime(), e = d - S;
            if (!g.hold || g.hold && g.hold_timeout > e) {
                if (Z && g.tap_double && "tap" == R && S - Q < g.tap_max_interval)
                    var e = Math.abs(Z[0].x - n.start[0].x), h = Math.abs(Z[0].y - n.start[0].y), e = Z && n.start && Math.max(e, h) < g.tap_double_distance;
                else
                    e = !1;
                e ? (H = "double_tap", Q = null, c("doubletap", {originalEvent: a,position: n.start}), b(a)) : (e = n.move ? Math.abs(n.move[0].x - n.start[0].x) : 0, h = n.move ? Math.abs(n.move[0].y - n.start[0].y) : 0, M = Math.max(e, h), M < g.tap_max_distance && (H = "tap", Q = d, Z = n.start, g.tap && (c("tap", {originalEvent: a,position: n.start}), b(a))))
            }
        }};
    v ? U(h, "touchstart touchmove touchend touchcancel", a) : (U(h, "mouseup mousedown mousemove", a), U(h, "mouseout", d))
}
jQuery.fn.hammer = function(h) {
    return this.each(function() {
        var g = new Hammer(this, h), L = jQuery(this);
        L.data("hammer", g);
        for (var I = "hold tap doubletap transformstart transform transformend dragstart drag dragend swipe release".split(" "), m = 0; m < I.length; m++)
            g["on" + I[m]] = function(g, h) {
                return function(m) {
                    g.trigger(jQuery.Event(h, m))
                }
            }(L, I[m])
    })
};
